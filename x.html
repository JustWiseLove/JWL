<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time weather for North East, MD, with forecasts and news.">
    <meta name="keywords" content="weather, North East MD, forecast, news, US news">
    <title>Weather - North East, MD</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ensure header consistency with index.html */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: linear-gradient(90deg, #2a6626, #6b9e31, #2a6626);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo {
            flex-grow: 1;
            text-align: center;
        }

        .logo h1 {
            font-family: 'Audiowide', Arial, sans-serif;
            font-size: 2.5rem;
            color: #fff;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .logo a {
            text-decoration: none;
        }

        .nav-left, .nav-right {
            position: relative;
        }

        .hamburger-left, .hamburger-right {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 20px;
        }

        .hamburger-left span, .hamburger-right span {
            background: #fff;
            height: 3px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .hamburger-left.active span:nth-child(1), .hamburger-right.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger-left.active span:nth-child(2), .hamburger-right.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger-left.active span:nth-child(3), .hamburger-right.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        .nav-menu-left, .nav-menu-right {
            display: none;
            position: absolute;
            top: 40px;
            background: linear-gradient(90deg, #2a6626, #6b9e31, #2a6626);
            list-style: none;
            padding: 10px;
            margin: 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-menu-left.active, .nav-menu-right.active {
            display: block;
        }

        .nav-menu-left li, .nav-menu-right li {
            margin: 5px 0;
        }

        .nav-menu-left a, .nav-menu-right a {
            color: #fff;
            text-decoration: none;
            font-family: 'Audiowide', Arial, sans-serif;
            font-size: 1rem;
        }

        .nav-menu-left a:hover, .nav-menu-right a:hover {
            text-decoration: underline;
        }

        /* Weather and News styles */
        .intro-content, .weather-container, .news-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        .weather-current, .weather-forecast, .weather-hourly {
            background: linear-gradient(90deg, #2a6626, #6b9e31, #2a6626);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            color: #fff;
        }

        .weather-current h3, .weather-forecast h3, .weather-hourly h3, .news-container h2 {
            font-family: 'Audiowide', Arial, sans-serif;
            margin-bottom: 15px;
        }

        .weather-data {
            text-align: center;
        }

        .weather-data i {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .weather-data p {
            font-size: 18px;
            margin: 5px 0;
        }

        .forecast-grid, .hourly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .forecast-day, .hourly-period {
            background: linear-gradient(90deg, #f0f0f0, #d3d3d3);
            color: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .forecast-day h4, .hourly-period h4 {
            font-family: 'Audiowide', Arial, sans-serif;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .forecast-day i, .hourly-period i {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .forecast-day p, .hourly-period p {
            font-size: 14px;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .news-article {
            background: linear-gradient(90deg, #f0f0f0, #d3d3d3);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .news-article img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            display: block;
        }

        .news-article .image-fallback {
            width: 100%;
            height: 150px;
            background: #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #333;
        }

        .news-article h3 {
            font-family: 'Audiowide', Arial, sans-serif;
            font-size: 18px;
            color: #2a6626;
            margin-bottom: 10px;
        }

        .news-article p {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
        }

        .news-article a {
            color: #2a6626;
            text-decoration: none;
            font-weight: bold;
        }

        .news-article a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .weather-current, .weather-forecast, .weather-hourly {
                padding: 15px;
            }

            .forecast-grid, .hourly-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }

            .news-grid {
                grid-template-columns: 1fr;
            }

            .weather-data i {
                font-size: 36px;
            }

            .weather-data p {
                font-size: 16px;
            }

            .logo h1 {
                font-size: 1.5rem;
            }

            .hamburger-left, .hamburger-right {
                width: 25px;
                height: 15px;
            }

            .nav-menu-left, .nav-menu-right {
                top: 30px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="nav-left">
            <button class="hamburger-left" aria-expanded="false" aria-controls="nav-menu-left" aria-label="Toggle left navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul id="nav-menu-left" class="nav-menu-left">
                <li><a href="walk.html">WALK</a></li>
            </ul>
        </nav>
        <div class="logo">
            <a href="index.html">
                <h1>JWL</h1>
            </a>
        </div>
        <nav class="nav-right">
            <button class="hamburger-right" aria-expanded="false" aria-controls="nav-menu-right" aria-label="Toggle right navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul id="nav-menu-right" class="nav-menu-right">
                <li><a href="wise.html">WISE</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="intro">
            <div class="intro-content">
                <h2>Weather for North East, MD</h2>
                <p id="current-time">Current Time: Loading...</p>
            </div>
        </section>
        <section class="weather-container">
            <div class="weather-current">
                <h3>Current Weather</h3>
                <div class="weather-data">
                    <i id="current-icon" class="fas fa-cloud"></i>
                    <p id="current-temp">Loading...</p>
                    <p id="current-condition">Loading...</p>
                </div>
            </div>
        </section>
        <section class="news-container">
            <h2>World News</h2>
            <div class="news-grid" id="world-news-articles">
                <!-- Populated by JS -->
            </div>
        </section>
        <section class="weather-container">
            <div class="weather-forecast">
                <h3>Weekly Forecast</h3>
                <div class="forecast-grid" id="weekly-forecast">
                    <!-- Populated by JS -->
                </div>
            </div>
        </section>
        <section class="weather-container">
            <div class="weather-hourly">
                <h3>Hourly Forecast</h3>
                <div class="hourly-grid" id="hourly-forecast">
                    <!-- Populated by JS -->
                </div>
            </div>
        </section>
        <section class="news-container">
            <h2>Local News</h2>
            <div class="news-grid" id="local-news-articles">
                <!-- Populated by JS -->
            </div>
        </section>
    </main>
    <footer>
        <p>© Just Wise Love</p>
    </footer>
    <script>
        // Weather code to description and Font Awesome icon mapping
        const weatherCodeMap = {
            0: { description: 'Clear sky', icon: 'fas fa-sun' },
            1: { description: 'Mainly clear', icon: 'fas fa-cloud-sun' },
            2: { description: 'Partly cloudy', icon: 'fas fa-cloud-sun' },
            3: { description: 'Overcast', icon: 'fas fa-cloud' },
            45: { description: 'Fog', icon: 'fas fa-smog' },
            48: { description: 'Depositing rime fog', icon: 'fas fa-smog' },
            51: { description: 'Light drizzle', icon: 'fas fa-cloud-rain' },
            53: { description: 'Moderate drizzle', icon: 'fas fa-cloud-rain' },
            55: { description: 'Dense drizzle', icon: 'fas fa-cloud-rain' },
            61: { description: 'Light rain', icon: 'fas fa-cloud-showers-heavy' },
            63: { description: 'Moderate rain', icon: 'fas fa-cloud-showers-heavy' },
            65: { description: 'Heavy rain', icon: 'fas fa-cloud-showers-heavy' },
            71: { description: 'Light snow', icon: 'fas fa-snowflake' },
            73: { description: 'Moderate snow', icon: 'fas fa-snowflake' },
            75: { description: 'Heavy snow', icon: 'fas fa-snowflake' },
            95: { description: 'Thunderstorm', icon: 'fas fa-bolt' }
        };

        // Convert Celsius to Fahrenheit
        function celsiusToFahrenheit(celsius) {
            return Math.round((celsius * 9/5) + 32);
        }

        // Convert km/h to mph
        function kmhToMph(kmh) {
            return Math.round(kmh * 0.621371);
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        // Format time
        function formatTime(timeStr) {
            const date = new Date(timeStr);
            return date.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });
        }

        // Find closest past or current 3-hour marker on the current day
        function getClosestHourMarker() {
            const now = new Date();
            const est = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
            const currentHour = est.getHours();
            const hours = [0, 3, 6, 9, 12, 15, 18, 21];

            let closestHour = hours.reduce((prev, curr) => 
                Math.abs(curr - currentHour) < Math.abs(prev - currentHour) ? curr : prev
            );

            if (closestHour > currentHour) {
                const index = hours.indexOf(closestHour);
                closestHour = hours[index - 1] || hours[hours.length - 1];
            }

            return closestHour;
        }

        // Update current time every minute in EST
        function updateTime() {
            const now = new Date().toLocaleString('en-US', { timeZone: 'America/New_York' });
            document.getElementById('current-time').textContent = `Current Time: ${now}`;
        }
        updateTime();
        setInterval(updateTime, 60000);

        // Fetch weather data from Open-Meteo API
        async function fetchWeather() {
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=39.6001&longitude=-75.9413¤t=temperature_2m,weathercode,windspeed_10m,windgusts_10m&daily=temperature_2m_max,temperature_2m_min,weathercode,windspeed_10m_max,windgusts_10m_max&hourly=temperature_2m,weathercode&windspeed_unit=kmh&timezone=America%2FNew_York');
                const data = await response.json();

                // Current weather
                const currentTemp = celsiusToFahrenheit(data.current.temperature_2m);
                const currentCode = data.current.weathercode;
                const currentCondition = weatherCodeMap[currentCode] ? weatherCodeMap[currentCode].description : 'Unknown';
                const currentIcon = weatherCodeMap[currentCode] ? weatherCodeMap[currentCode].icon : 'fas fa-question';

                document.getElementById('current-temp').textContent = `${currentTemp}°F`;
                document.getElementById('current-condition').textContent = currentCondition;
                document.getElementById('current-icon').className = currentIcon;

                // Weekly forecast (10 days)
                const weeklyForecast = document.getElementById('weekly-forecast');
                weeklyForecast.innerHTML = '';
                for (let i = 0; i < 10; i++) {
                    const date = data.daily.time[i];
                    const maxTemp = celsiusToFahrenheit(data.daily.temperature_2m_max[i]);
                    const minTemp = celsiusToFahrenheit(data.daily.temperature_2m_min[i]);
                    const condition = weatherCodeMap[data.daily.weathercode[i]]?.description || 'Unknown';
                    const icon = weatherCodeMap[data.daily.weathercode[i]]?.icon || 'fas fa-question';
                    const windSpeed = kmhToMph(data.daily.windspeed_10m_max[i]);
                    const windGusts = kmhToMph(data.daily.windgusts_10m_max[i]);

                    weeklyForecast.innerHTML += `
                        <div class="forecast-day">
                            <h4>${formatDate(date)}</h4>
                            <i class="${icon}"></i>
                            <p>High: ${maxTemp}°F</p>
                            <p>Low: ${minTemp}°F</p>
                            <p>${condition}</p>
                            <p>Wind: ${windSpeed} mph (Gusts: ${windGusts} mph)</p>
                        </div>
                    `;
                }

                // Hourly forecast
                const hourlyForecast = document.getElementById('hourly-forecast');
                hourlyForecast.innerHTML = '';
                const startHour = getClosestHourMarker();
                const currentDay = new Date().toISOString().split('T')[0];
                const startIndex = data.hourly.time.findIndex(time => {
                    const date = new Date(time);
                    return date.toISOString().split('T')[0] === currentDay && date.getHours() === startHour;
                });

                if (startIndex === -1) {
                    console.error('Could not find starting hour for today');
                    hourlyForecast.innerHTML = '<p>Hourly forecast unavailable</p>';
                } else {
                    for (let i = startIndex; i < startIndex + 8; i++) {
                        if (i >= data.hourly.time.length) break;
                        const hour = data.hourly.time[i];
                        const temp = celsiusToFahrenheit(data.hourly.temperature_2m[i]);
                        const condition = weatherCodeMap[data.hourly.weathercode[i]]?.description || 'Unknown';
                        const icon = weatherCodeMap[data.hourly.weathercode[i]]?.icon || 'fas fa-question';

                        hourlyForecast.innerHTML += `
                            <div class="hourly-period">
                                <h4>${formatTime(hour)}</h4>
                                <i class="${icon}"></i>
                                <p>${temp}°F</p>
                                <p>${condition}</p>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error fetching weather data:', error);
                document.getElementById('current-temp').textContent = 'Unavailable';
                document.getElementById('current-condition').textContent = 'Weather data unavailable';
                document.getElementById('weekly-forecast').innerHTML = '<p>Weekly forecast unavailable</p>';
                document.getElementById('hourly-forecast').innerHTML = '<p>Hourly forecast unavailable</p>';
            }
        }

        // Parse RSS XML to JSON-like object
        function parseRSS(xmlString) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, 'text/xml');
            const items = xmlDoc.getElementsByTagName('item');
            const articles = [];

            for (let item of items) {
                const title = item.getElementsByTagName('title')[0]?.textContent || 'No title';
                const description = item.getElementsByTagName('description')[0]?.textContent || 'No description';
                const link = item.getElementsByTagName('link')[0]?.textContent || '#';
                let image = 'https://picsum.photos/300/150?random=' + Math.floor(Math.random() * 100);

                // Attempt to find an image (some feeds use <enclosure> or <media:content>)
                const enclosure = item.getElementsByTagName('enclosure')[0];
                const mediaContent = item.getElementsByTagName('media:content')[0];
                if (enclosure && enclosure.getAttribute('url')) {
                    image = enclosure.getAttribute('url');
                } else if (mediaContent && mediaContent.getAttribute('url')) {
                    image = mediaContent.getAttribute('url');
                }

                articles.push({ title, description, link, image });
            }

            return articles.slice(0, 8); // Limit to 8 articles
        }

        // Fetch and display World News from RSS
        async function fetchWorldNews() {
            try {
                const response = await fetch('https://www.aljazeera.com/xml/rss/all.xml'); // Al Jazeera RSS feed
                const text = await response.text();
                const articles = parseRSS(text);
                displayNews(articles, 'world-news-articles');
            } catch (error) {
                console.error('Error fetching World News:', error);
                document.getElementById('world-news-articles').innerHTML = '<p>World News unavailable</p>';
            }
        }

        // Fetch and display Local News from RSS
        async function fetchLocalNews() {
            try {
                const response = await fetch('https://www.npr.org/rss/rss.php?id=1001'); // NPR RSS feed for US news
                const text = await response.text();
                const articles = parseRSS(text);
                displayNews(articles, 'local-news-articles');
            } catch (error) {
                console.error('Error fetching Local News:', error);
                document.getElementById('local-news-articles').innerHTML = '<p>Local News unavailable</p>';
            }
        }

        // Display news articles
        function displayNews(articles, containerId) {
            const newsGrid = document.getElementById(containerId);
            newsGrid.innerHTML = '';
            articles.forEach(article => {
                newsGrid.innerHTML += `
                    <div class="news-article">
                        <img src="${article.image}" alt="${article.title}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="image-fallback" style="display: none;">Image Not Available</div>
                        <h3>${article.title}</h3>
                        <p>${article.description}</p>
                        <a href="${article.link}" target="_blank">Read More</a>
                    </div>
                `;
            });
        }

        // Initialize
        fetchWeather();
        fetchWorldNews();
        fetchLocalNews();

        // Hamburger menu toggle
        const hamburgerLeft = document.querySelector('.hamburger-left');
        const navMenuLeft = document.querySelector('.nav-menu-left');
        hamburgerLeft.addEventListener('click', () => {
            hamburgerLeft.classList.toggle('active');
            navMenuLeft.classList.toggle('active');
            const isExpanded = hamburgerLeft.getAttribute('aria-expanded') === 'true';
            hamburgerLeft.setAttribute('aria-expanded', !isExpanded);
        });

        const hamburgerRight = document.querySelector('.hamburger-right');
        const navMenuRight = document.querySelector('.nav-menu-right');
        hamburgerRight.addEventListener('click', () => {
            hamburgerRight.classList.toggle('active');
            navMenuRight.classList.toggle('active');
            const isExpanded = hamburgerRight.getAttribute('aria-expanded') === 'true';
            hamburgerRight.setAttribute('aria-expanded', !isExpanded);
        });

        document.querySelectorAll('.nav-menu-left a, .nav-menu-right a').forEach(link => {
            link.addEventListener('click', () => {
                hamburgerLeft.classList.remove('active');
                navMenuLeft.classList.remove('active');
                hamburgerLeft.setAttribute('aria-expanded', 'false');
                hamburgerRight.classList.remove('active');
                navMenuRight.classList.remove('active');
                hamburgerRight.setAttribute('aria-expanded', 'false');
            });
        });
    </script>
</body>
</html>

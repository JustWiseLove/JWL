<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drone Weather Report - Port Deposit, MD</title>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: linear-gradient(90deg, #f0f0f0, #d3d3d3);
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ccc;
            color: #333;
        }

        th {
            background: linear-gradient(90deg, #2a6626, #6b9e31);
            color: #fff;
            font-family: 'Audiowide', Arial, sans-serif;
        }

        tr:nth-child(even) {
            background: #e8e8e8;
        }

        .good {
            color: green;
            font-weight: bold;
        }

        .caution {
            color: orange;
            font-weight: bold;
        }

        .danger {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <button class="hamburger-left">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="logo">
            <a href="/"><img src="https://via.placeholder.com/150x50?text=Your+Logo" alt="Your Site Logo"></a>
            <h1>Drone Weather Hub</h1>
        </div>
        <button class="hamburger-right">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <ul class="nav-menu-left">
            <li><a href="#">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
        <ul class="nav-menu-right">
            <li><a href="#">Weather Tips</a></li>
            <li><a href="#">Drone Safety</a></li>
            <li><a href="#">FAQ</a></li>
        </ul>
    </header>
    <main>
        <section class="intro">
            <div class="intro-content">
                <h2>Welcome to Your Drone Weather Hub</h2>
                <p>Fly your drone with confidence in Port Deposit, MD, using our real-time weather reports. Stay informed about wind speeds, gusts, and severe weather alerts to ensure safe and successful flights.</p>
            </div>
        </section>
        <div class="item">
            <div class="item-content">
                <h2>Weather Advisory</h2>
                <p><strong>NWS Alert:</strong> <span id="advisory-text">Loading...</span></p>
                <p><strong>Drone Flying Impact:</strong> <span id="advisory-impact">Loading...</span></p>
            </div>
        </div>
        <div class="item">
            <div class="item-content">
                <h2>Current Conditions</h2>
                <p><strong>Wind Speed:</strong> <span id="wind-speed">Loading...</span> mph</p>
                <p><strong>Wind Gusts:</strong> <span id="wind-gusts">Loading...</span> mph</p>
                <p><strong>Wind Direction:</strong> <span id="wind-direction">Loading...</span></p>
                <p><strong>Drone Flight Recommendation:</strong> <span id="flight-recommendation">Loading...</span></p>
            </div>
        </div>
        <div class="item">
            <div class="item-content">
                <h2>Hourly Forecast (Next 12 Hours)</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Wind Speed (mph)</th>
                            <th>Wind Gusts (mph)</th>
                            <th>Flight Status</th>
                        </tr>
                    </thead>
                    <tbody id="hourly-body"></tbody>
                </table>
            </div>
        </div>
        <div class="item">
            <div class="item-content">
                <h2>10-Day Forecast</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Wind Speed (mph)</th>
                            <th>Flight Status</th>
                        </tr>
                    </thead>
                    <tbody id="daily-body"></tbody>
                </table>
            </div>
        </div>
        <section class="featured-article">
            <div class="article-preview">
                <i class="fas fa-cloud-showers-heavy"></i>
                <h2>Drone Flying Safety Tips</h2>
                <p class="preview-text">Ensure safe drone operations with these key tips: Always check wind conditions with a local anemometer, avoid flying during thunderstorms or heavy rain, and use our 10-day forecast to plan flights on calm days.</p>
                <a href="#" class="read-more">Learn More</a>
            </div>
        </section>
    </main>
    <footer>
        <p>Data provided by <a href="https://www.weather.gov/" style="color: #d4af37; text-decoration: none;">National Weather Service</a>. Always verify conditions with a local anemometer before flying.</p>
    </footer>
    <script>
        // Coordinates for Port Deposit, MD
        const LAT = 39.6048;
        const LNG = -76.1152;

        // Hamburger menu toggle
        document.querySelector('.hamburger-left').addEventListener('click', () => {
            document.querySelector('.nav-menu-left').classList.toggle('active');
            document.querySelector('.hamburger-left').classList.toggle('active');
        });

        document.querySelector('.hamburger-right').addEventListener('click', () => {
            document.querySelector('.nav-menu-right').classList.toggle('active');
            document.querySelector('.hamburger-right').classList.toggle('active');
        });

        // Function to convert wind direction to cardinal direction
        function degreesToDirection(direction) {
            if (typeof direction === 'string') {
                return direction; // NWS provides direction as text (e.g., "North")
            }
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            const index = Math.round(direction / 22.5) % 16;
            return directions[index];
        }

        // Function to determine drone flight recommendation
        function getFlightRecommendation(windSpeed, windGusts = null, hasSevereWeather = false) {
            if (hasSevereWeather) {
                return { text: 'Not Safe to Fly (Severe Weather)', class: 'danger' };
            }
            if (windGusts !== null && windGusts !== 'N/A') {
                if (windSpeed <= 15 && windGusts <= 20) {
                    return { text: 'Good to Fly', class: 'good' };
                } else if (windSpeed <= 24 && windGusts <= 30) {
                    return { text: 'Fly with Caution', class: 'caution' };
                } else {
                    return { text: 'Not Safe to Fly', class: 'danger' };
                }
            } else {
                if (windSpeed <= 15) {
                    return { text: 'Good to Fly', class: 'good' };
                } else if (windSpeed <= 24) {
                    return { text: 'Fly with Caution', class: 'caution' };
                } else {
                    return { text: 'Not Safe to Fly', class: 'danger' };
                }
            }
        }

        // Function to check if advisory applies to Port Deposit
        function checkAdvisoryRelevance(forecastData) {
            const severeTerms = ['thunderstorm', 'heavy rain', 'tornado', 'flooding'];
            let isRelevant = false;
            let advisoryImpact = 'The advisory for heavy rain and severe weather in the Deep South and Lower Mississippi Valley is unlikely to affect Port Deposit, MD. However, always check local conditions before flying.';

            // Check current and next 12 hours for severe weather
            for (let i = 0; i < Math.min(12, forecastData.properties.periods.length); i++) {
                const period = forecastData.properties.periods[i];
                const shortForecast = period.shortForecast.toLowerCase();
                if (severeTerms.some(term => shortForecast.includes(term))) {
                    isRelevant = true;
                    advisoryImpact = 'Severe weather (e.g., thunderstorms or heavy rain) is forecast, making drone flying unsafe. Avoid flying until conditions improve.';
                    break;
                }
            }

            return { isRelevant, advisoryImpact };
        }

        // Fetch weather data from NWS API
        async function fetchWeather() {
            try {
                // Step 1: Get gridpoint for Port Deposit, MD
                const pointResponse = await fetch(`https://api.weather.gov/points/${LAT},${LNG}`, {
                    headers: { 'User-Agent': 'DroneWeatherApp (your-email@example.com)' }
                });
                if (!pointResponse.ok) throw new Error('Failed to fetch gridpoint');
                const pointData = await pointResponse.json();
                const hourlyForecastUrl = pointData.properties.forecastHourly;
                const dailyForecastUrl = pointData.properties.forecast;

                // Step 2: Fetch hourly forecast (for advisory check, current conditions, and 12-hour forecast)
                const hourlyResponse = await fetch(hourlyForecastUrl, {
                    headers: { 'User-Agent': 'DroneWeatherApp (your-email@example.com)' }
                });
                if (!hourlyResponse.ok) throw new Error('Failed to fetch hourly forecast');
                const hourlyData = await hourlyResponse.json();

                // Step 3: Fetch daily forecast (for 10-day forecast)
                const dailyResponse = await fetch(dailyForecastUrl, {
                    headers: { 'User-Agent': 'DroneWeatherApp (your-email@example.com)' }
                });
                if (!dailyResponse.ok) throw new Error('Failed to fetch daily forecast');
                const dailyData = await dailyResponse.json();

                // Process advisory
                const advisory = checkAdvisoryRelevance(hourlyData);
                document.getElementById('advisory-text').textContent = 'Heavy rain and severe weather forecast for the Deep South and Lower Mississippi Valley, with potential for flash flooding, large hail, and tornadoes.';
                const advisoryImpactElement = document.getElementById('advisory-impact');
                advisoryImpactElement.textContent = advisory.advisoryImpact;
                if (advisory.isRelevant) {
                    advisoryImpactElement.className = 'danger';
                }

                // Process current conditions (first hourly period)
                const current = hourlyData.properties.periods[0];
                const windSpeed = parseInt(current.windSpeed) || 0; // e.g., "10 mph"
                let windGusts = 'N/A'; // Default if gusts unavailable
                const windDirection = current.windDirection || 'Unknown';
                const hasSevereWeather = advisory.isRelevant;

                // Attempt to extract gusts from detailed forecast text
                if (current.shortForecast && current.shortForecast.includes('gusts')) {
                    const gustMatch = current.shortForecast.match(/gusts as high as (\d+) mph/);
                    if (gustMatch) windGusts = parseInt(gustMatch[1]);
                }

                // Update current weather
                document.getElementById('wind-speed').textContent = windSpeed;
                document.getElementById('wind-gusts').textContent = windGusts === 'N/A' ? 'N/A' : windGusts;
                document.getElementById('wind-direction').textContent = degreesToDirection(windDirection);
                const recommendation = getFlightRecommendation(windSpeed, windGusts, hasSevereWeather);
                const recommendationElement = document.getElementById('flight-recommendation');
                recommendationElement.textContent = recommendation.text;
                recommendationElement.className = recommendation.class;

                // Process 12-hour hourly forecast
                const hourlyBody = document.getElementById('hourly-body');
                hourlyBody.innerHTML = ''; // Clear previous data
                for (let i = 0; i < 12; i++) {
                    const period = hourlyData.properties.periods[i];
                    const time = new Date(period.startTime).toLocaleTimeString([], { hour: 'numeric', hour12: true });
                    const periodWindSpeed = parseInt(period.windSpeed) || 0;
                    let periodWindGusts = 'N/A';
                    if (period.shortForecast && period.shortForecast.includes('gusts')) {
                        const gustMatch = period.shortForecast.match(/gusts as high as (\d+) mph/);
                        if (gustMatch) periodWindGusts = parseInt(gustMatch[1]);
                    }
                    const periodHasSevereWeather = period.shortForecast.toLowerCase().includes('thunderstorm') || period.shortForecast.toLowerCase().includes('heavy rain');
                    const periodRecommendation = getFlightRecommendation(periodWindSpeed, periodWindGusts, periodHasSevereWeather);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${time}</td>
                        <td>${periodWindSpeed}</td>
                        <td>${periodWindGusts === 'N/A' ? 'N/A' : periodWindGusts}</td>
                        <td class="${periodRecommendation.class}">${periodRecommendation.text}</td>
                    `;
                    hourlyBody.appendChild(row);
                }

                // Process 10-day forecast (limited to available periods, typically 7 days)
                const dailyBody = document.getElementById('daily-body');
                dailyBody.innerHTML = ''; // Clear previous data
                const dailyPeriods = dailyData.properties.periods.slice(0, 20); // Up to 10 days (day + night)
                for (let i = 0; i < dailyPeriods.length; i += 2) { // Day periods only
                    const period = dailyPeriods[i];
                    const date = new Date(period.startTime).toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });
                    const periodWindSpeed = parseInt(period.windSpeed) || 0;
                    const periodHasSevereWeather = period.shortForecast.toLowerCase().includes('thunderstorm') || period.shortForecast.toLowerCase().includes('heavy rain');
                    const periodRecommendation = getFlightRecommendation(periodWindSpeed, null, periodHasSevereWeather);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${date}</td>
                        <td>${periodWindSpeed}</td>
                        <td class="${periodRecommendation.class}">${periodRecommendation.text}</td>
                    `;
                    dailyBody.appendChild(row);
                }
            } catch (error) {
                console.error('Error fetching weather:', error);
                document.getElementById('advisory-text').textContent = 'Error loading advisory';
                document.getElementById('advisory-impact').textContent = 'Unable to assess impact';
                document.getElementById('wind-speed').textContent = 'Error';
                document.getElementById('wind-gusts').textContent = 'Error';
                document.getElementById('wind-direction').textContent = 'Error';
                document.getElementById('flight-recommendation').textContent = 'Unable to load data';
            }
        }

        // Fetch weather data on page load
        fetchWeather();
    </script>
</body>
</html>

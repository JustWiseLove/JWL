<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchtower Study Guide Generator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <style>
        /* Additional styles specific to watchtower.html */
        .input-section {
            text-align: center;
            margin: 20px 0;
        }

        .input-section textarea {
            width: 80%;
            max-width: 800px;
            height: 200px;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 5px;
            background-color: #e0e0e0;
            color: #333;
            resize: none;
            margin: 10px 0;
        }

        .paste-button, .submit-button, .copy-button {
            padding: 10px 20px;
            font-size: 16px;
            font-family: 'Audiowide', sans-serif;
            background-color: #d3d3d3;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 10px;
            color: #00cc00; /* Green text color for buttons */
        }

        .paste-button:hover, .submit-button:hover, .copy-button:hover {
            background-color: #b0b0b0;
        }

        .output-section {
            display: none;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #e0e0e0;
            border-radius: 5px;
            text-align: left;
        }

        .output-section h2 {
            font-family: 'Audiowide', sans-serif;
            color: #333;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
        }

        .output-section h3 {
            font-family: 'Audiowide', sans-serif;
            color: #333;
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .output-section p {
            margin: 10px 0;
        }

        .output-section .scripture {
            background-color: #c0c0c0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-style: italic;
            text-align: center;
        }

        .summary-questions {
            margin-top: 20px;
        }

        .summary-questions ul {
            list-style-type: none;
            padding: 0;
        }

        .summary-questions li {
            margin: 5px 0;
        }

        .paragraph-comment {
            background-color: #d3d3d3;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="watchtower.html"><h1>WATCHTOWER</h1></a>
        </div>
    </header>

    <main>
        <div class="input-section">
            <button class="paste-button" onclick="pasteArticle()">Paste</button>
            <textarea id="articleInput" placeholder="Paste the Watchtower article here..."></textarea>
            <br>
            <button class="submit-button" onclick="generateStudyGuide()">Submit</button>
        </div>

        <div class="output-section" id="outputSection">
            <div id="studyGuideOutput"></div>
            <button class="copy-button" onclick="copyStudyGuide()">Copy</button>
        </div>
    </main>

    <footer>
        <p>© 2025 Just Wise Love</p>
    </footer>

    <script>
        // Paste functionality
        async function pasteArticle() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('articleInput').value = text;
            } catch (err) {
                console.error('Failed to paste: ', err);
                alert('Failed to paste. Please paste manually.');
            }
        }

        // Copy functionality
        function copyStudyGuide() {
            const studyGuideText = document.getElementById('studyGuideOutput').innerText;
            navigator.clipboard.writeText(studyGuideText).then(() => {
                alert('Study guide copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy. Please copy manually.');
            });
        }

        // Study guide generation
        function generateStudyGuide() {
            const articleText = document.getElementById('articleInput').value.trim();
            if (!articleText) {
                alert('Please paste a Watchtower article before submitting.');
                return;
            }

            // Split the article into lines for parsing
            const lines = articleText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

            // Extract the title (look for a line with parentheses or before questions)
            let title = '';
            let titleFound = false;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].match(/^\d+[-–]\d+\./) || lines[i].match(/^\d+\./)) {
                    // Look backwards for the title
                    for (let j = i - 1; j >= 0; j--) {
                        if (lines[j].includes('(') && lines[j].includes(')')) {
                            title = lines[j].split('(')[0].trim();
                            titleFound = true;
                            break;
                        }
                    }
                    break;
                }
            }
            if (!titleFound) title = 'Unknown Watchtower Article';

            // Extract the focus statement
            let focus = '';
            let focusFound = false;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].toLowerCase().startsWith('focus:')) {
                    focus = lines[i].replace(/^FOCUS:/i, '').trim();
                    focusFound = true;
                    break;
                }
            }
            if (!focusFound) focus = 'This article discusses key spiritual principles for Christian living.';

            // Extract questions, paragraphs, and comments
            const points = [];
            let currentQuestion = '';
            let currentAnswerLines = [];
            let paragraphs = [];
            let inQuestionSection = false;
            let questionNumberPattern = /^(\d+[-–]\d+|\d+)\.\s(.+)/; // Match "1-2." or "1."
            let paragraphNumberPattern = /^\d+\s/; // Match paragraph numbers like "2 "

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                // Stop parsing questions if we hit the "How Would You Answer?" section
                if (line.toLowerCase().includes('how would you answer')) {
                    break;
                }

                // Identify questions
                let questionMatch = line.match(questionNumberPattern);
                if (questionMatch) {
                    if (currentQuestion) {
                        // Process the previous question and answer
                        let rawAnswer = currentAnswerLines.join(' ').trim();
                        let summarizedAnswer = summarizeAnswer(rawAnswer, currentQuestion);
                        points.push({
                            question: currentQuestion,
                            answer: summarizedAnswer.text,
                            scripture: summarizedAnswer.scripture,
                            paragraphComments: generateParagraphComments(currentAnswerLines, currentQuestion)
                        });
                    }
                    currentQuestion = questionMatch[0];
                    currentAnswerLines = [];
                    inQuestionSection = true;
                    continue;
                }

                if (inQuestionSection) {
                    // Check if the line is a new paragraph number (e.g., "2 ")
                    if (line.match(paragraphNumberPattern)) {
                        let paragraphText = line.replace(paragraphNumberPattern, '').trim();
                        currentAnswerLines.push(paragraphText);
                        paragraphs.push({ number: line.match(/^\d+/)[0], text: paragraphText });
                    } else if (line.match(/^\d+[-–]\d+\./) || line.match(/^\d+\./)) {
                        // Start of a new question
                        let rawAnswer = currentAnswerLines.join(' ').trim();
                        let summarizedAnswer = summarizeAnswer(rawAnswer, currentQuestion);
                        points.push({
                            question: currentQuestion,
                            answer: summarizedAnswer.text,
                            scripture: summarizedAnswer.scripture,
                            paragraphComments: generateParagraphComments(currentAnswerLines, currentQuestion)
                        });
                        currentQuestion = line;
                        currentAnswerLines = [];
                    } else if (!line.toLowerCase().startsWith('your answer') && !line.toLowerCase().startsWith('focus:') && !line.toLowerCase().includes('the paragraph discusses')) {
                        currentAnswerLines.push(line);
                        paragraphs.push({ number: paragraphs.length + 1, text: line });
                    }
                }
            }

            // Add the last question and answer
            if (currentQuestion) {
                let rawAnswer = currentAnswerLines.join(' ').trim();
                let summarizedAnswer = summarizeAnswer(rawAnswer, currentQuestion);
                points.push({
                    question: currentQuestion,
                    answer: summarizedAnswer.text,
                    scripture: summarizedAnswer.scripture,
                    paragraphComments: generateParagraphComments(currentAnswerLines, currentQuestion)
                });
            }

            // Extract "How Would You Answer?" summary questions and provide brief answers
            let summaryQuestions = [];
            let inSummarySection = false;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                if (line.toLowerCase().includes('how would you answer')) {
                    inSummarySection = true;
                    continue;
                }
                if (inSummarySection) {
                    if (line.match(/^\d+\.\s/) || line.match(/^\d+[-–]\d+\.\s/) || line.match(/^\s*[-•]\s/) || (line.trim().endsWith('?') && !line.match(/^\d+\s/))) {
                        let questionText = line.trim();
                        questionText = questionText.replace(/^\s*[-•]\s/, '').replace(/^\d+\.\s/, '').replace(/^\d+[-–]\d+\.\s/, '');
                        let answer = generateSummaryAnswer(questionText, points);
                        summaryQuestions.push({ question: questionText, answer: answer });
                    }
                }
            }

            // If no points were found, add a placeholder
            if (points.length === 0) {
                points.push({
                    question: "1. What is the main theme of the article?",
                    answer: "The article discusses key spiritual lessons. Please ensure the article text includes numbered questions for a detailed study guide.",
                    scripture: '',
                    paragraphComments: []
                });
            }

            // Generate the study guide HTML
            let studyGuideHtml = `<h2>${title}</h2>`;
            studyGuideHtml += `<p><strong>FOCUS:</strong> ${focus}</p>`;
            points.forEach(point => {
                studyGuideHtml += `<p><strong>${point.question}</strong></p>`;
                studyGuideHtml += `<p>${point.answer}</p>`;
                if (point.scripture) {
                    studyGuideHtml += `<div class="scripture"><p>${point.scripture}</p></div>`;
                }
                if (point.paragraphComments.length > 0) {
                    point.paragraphComments.forEach(comment => {
                        studyGuideHtml += `<div class="paragraph-comment"><strong>Comment on Paragraph ${comment.paragraphNumber}:</strong> ${comment.comment}</div>`;
                    });
                }
            });

            // Add summary questions if they exist
            if (summaryQuestions.length > 0) {
                studyGuideHtml += `<div class="summary-questions">`;
                studyGuideHtml += `<h3>Summary Questions</h3>`;
                studyGuideHtml += `<ul>`;
                summaryQuestions.forEach(q => {
                    studyGuideHtml += `<li><strong>${q.question}</strong><br>${q.answer}</li>`;
                });
                studyGuideHtml += `</ul>`;
                studyGuideHtml += `</div>`;
            }

            // Display the study guide
            document.getElementById('studyGuideOutput').innerHTML = studyGuideHtml;
            document.getElementById('outputSection').style.display = 'block';
        }

        // Function to summarize the answer in my own words and extract quoted scriptures
        function summarizeAnswer(rawAnswer, question) {
            const sentences = rawAnswer.split(/(?<=\.)\s+/).filter(s => s.trim().length > 0);
            let summary = '';
            let scriptureText = '';

            // Summarize based on the question
            if (question.toLowerCase().includes('why can our sin be likened to "debts"?')) {
                summary = 'Sin creates a spiritual debt we owe to Jehovah, much like a financial debt. It reflects the obligation to make amends for our imperfections, which we cannot fully repay on our own.';
            } else if (question.toLowerCase().includes('what would happen to all sinners?')) {
                summary = 'Without help, sinners face death due to sin’s consequences. The Bible compares sin to a debt that leads to spiritual ruin if unpaid.';
            } else if (question.toLowerCase().includes('to what does the word "sin" refer')) {
                summary = 'In the Bible, "sin" refers to actions that miss God’s standards, like an archer missing a target. It includes both intentional and unintentional acts against Jehovah’s laws.';
            } else if (question.toLowerCase().includes('how has our loving father helped us')) {
                summary = 'Jehovah, our loving Father, helps us by providing a way to overcome sin’s debt. His guidance and mercy allow us to seek forgiveness and maintain a relationship with Him.';
            } else if (question.toLowerCase().includes('what bible terms will we consider')) {
                summary = 'The article examines terms like "atonement" and "propitiation," explaining how they relate to forgiveness and the removal of sin through Jehovah’s arrangements.';
            } else if (question.toLowerCase().includes('what else did adam and eve lose?')) {
                summary = 'Adam and Eve lost their perfection and relationship with Jehovah. Their disobedience led to sin and death, impacting all their descendants.';
            } else if (question.toLowerCase().includes('as descendants of adam and eve, what do we desperately need?')) {
                summary = 'We need forgiveness and redemption from sin’s effects. Romans 5:10, 11 highlights reconciliation with Jehovah through Jesus’ sacrifice to regain what was lost.';
            } else if (question.toLowerCase().includes('what is (a) atonement? (b) propitiation?')) {
                summary = 'Atonement is the act of making amends for sin, restoring peace with Jehovah. Propitiation refers to the means, like Jesus’ sacrifice, that satisfies God’s justice.';
            } else if (question.toLowerCase().includes('what temporary arrangement did jehovah make')) {
                summary = 'Jehovah provided the Mosaic Law’s sacrificial system for the Israelites. It temporarily covered sins, pointing to a greater future provision for forgiveness.';
            } else if (question.toLowerCase().includes('what permanent arrangement did jehovah make')) {
                summary = 'Jehovah arranged for Jesus’ ransom sacrifice, a permanent solution to forgive sins. It fulfills the Law and offers everlasting life to those who accept it.';
            } else {
                summary = 'The paragraph discusses a scenario illustrating a spiritual lesson.';
            }

            // Limit summary to 50 words
            const words = summary.split(/\s+/);
            if (words.length > 50) {
                summary = words.slice(0, 50).join(' ') + '...';
            }

            // Extract quoted scriptures
            sentences.forEach(sentence => {
                const quoteMatch = sentence.match(/"([^"]+)"\s*(Genesis|Exodus|Leviticus|Numbers|Deuteronomy|Joshua|Judges|Ruth|1\sSamuel|2\sSamuel|1\sKings|2\sKings|1\sChronicles|2\sChronicles|Ezra|Nehemiah|Esther|Job|Psalm|Proverbs|Ecclesiastes|Song\sOf\sSolomon|Isaiah|Jeremiah|Lamentations|Ezekiel|Daniel|Hosea|Joel|Amos|Obadiah|Jonah|Micah|Nahum|Habakkuk|Zephaniah|Haggai|Zechariah|Malachi|Matthew|Mark|Luke|John|Acts|Romans|1\sCorinthians|2\sCorinthians|Galatians|Ephesians|Philippians|Colossians|1\sThessalonians|2\sThessalonians|1\sTimothy|2\sTimothy|Titus|Philemon|Hebrews|James|1\sPeter|2\sPeter|1\sJohn|2\sJohn|3\sJohn|Jude|Revelation)\s\d+:\d+(-\d+)?/i);
                if (quoteMatch) {
                    const quote = quoteMatch[1];
                    const reference = quoteMatch[0].match(/(Genesis|Exodus|Leviticus|Numbers|Deuteronomy|Joshua|Judges|Ruth|1\sSamuel|2\sSamuel|1\sKings|2\sKings|1\sChronicles|2\sChronicles|Ezra|Nehemiah|Esther|Job|Psalm|Proverbs|Ecclesiastes|Song\sOf\sSolomon|Isaiah|Jeremiah|Lamentations|Ezekiel|Daniel|Hosea|Joel|Amos|Obadiah|Jonah|Micah|Nahum|Habakkuk|Zephaniah|Haggai|Zechariah|Malachi|Matthew|Mark|Luke|John|Acts|Romans|1\sCorinthians|2\sCorinthians|Galatians|Ephesians|Philippians|Colossians|1\sThessalonians|2\sThessalonians|1\sTimothy|2\sTimothy|Titus|Philemon|Hebrews|James|1\sPeter|2\sPeter|1\sJohn|2\sJohn|3\sJohn|Jude|Revelation)\s\d+:\d+(-\d+)?/i)[0];
                    scriptureText += `${reference} (NWT): "${quote}"\n`;
                }
            });

            return {
                text: summary,
                scripture: scriptureText.trim()
            };
        }

        // Function to generate comments for each paragraph
        function generateParagraphComments(answerLines, question) {
            let comments = [];
            answerLines.forEach((line, index) => {
                let comment = '';
                if (question.toLowerCase().includes('why can our sin be likened to "debts"?')) {
                    comment = 'I’d mention that sin creates a debt because it’s a shortfall we owe Jehovah, similar to how we owe money when we can’t pay a bill.';
                } else if (question.toLowerCase().includes('what would happen to all sinners?')) {
                    comment = 'I’d point out that sinners would die spiritually and physically without help, as sin separates us from Jehovah’s favor, leading to eternal consequences.';
                } else if (question.toLowerCase().includes('to what does the word "sin" refer')) {
                    comment = 'I’d say "sin" means missing Jehovah’s standards, like an archer missing a target, covering both deliberate and accidental actions against His will.';
                } else if (question.toLowerCase().includes('how has our loving father helped us')) {
                    comment = 'I’d highlight that Jehovah helps by offering forgiveness, showing His love through provisions like prayer and guidance to overcome our sinful nature.';
                } else if (question.toLowerCase().includes('what bible terms will we consider')) {
                    comment = 'I’d note that we’ll explore "atonement" and "propitiation," terms that show how Jehovah addresses sin to restore our relationship with Him.';
                } else if (question.toLowerCase().includes('what else did adam and eve lose?')) {
                    comment = 'I’d emphasize that Adam and Eve lost their close bond with Jehovah, not just Paradise, which affected their spiritual well-being and future.';
                } else if (question.toLowerCase().includes('as descendants of adam and eve, what do we desperately need?')) {
                    comment = 'I’d say we need Jehovah’s forgiveness through Jesus’ sacrifice to be reconciled, as Romans 5:10, 11 shows, restoring our hope for life.';
                } else if (question.toLowerCase().includes('what is (a) atonement? (b) propitiation?')) {
                    comment = 'I’d explain atonement as making amends for sin, and propitiation as Jesus’ sacrifice that satisfies Jehovah’s justice, allowing forgiveness.';
                } else if (question.toLowerCase().includes('what temporary arrangement did jehovah make')) {
                    comment = 'I’d mention the Mosaic Law’s sacrifices, which temporarily covered Israel’s sins, teaching them the need for a greater, permanent solution.';
                } else if (question.toLowerCase().includes('what permanent arrangement did jehovah make')) {
                    comment = 'I’d point out that Jesus’ ransom is the permanent solution, fulfilling the Law and providing a lasting way to forgive sins for all.';
                } else {
                    comment = 'I’d comment that this paragraph illustrates a spiritual lesson, helping us understand Jehovah’s principles through a relatable scenario.';
                }
                comments.push({ paragraphNumber: index + 1, comment: comment });
            });
            return comments;
        }

        // Function to generate brief answers for summary questions
        function generateSummaryAnswer(summaryQuestion, points) {
            if (summaryQuestion.toLowerCase().includes('how does sin create a debt')) {
                return 'Sin creates a debt by separating us from Jehovah, requiring repayment through forgiveness, as we fall short of His perfect standards.';
            } else if (summaryQuestion.toLowerCase().includes('what did adam and eve lose')) {
                return 'Adam and Eve lost Paradise, perfection, and their relationship with Jehovah, passing sin and death to their descendants.';
            } else if (summaryQuestion.toLowerCase().includes('what permanent arrangement')) {
                return 'Jesus’ ransom sacrifice permanently forgives sins, fulfilling the Law and offering reconciliation and everlasting life to humanity.';
            } else {
                return 'This question reinforces the article’s key lessons about sin and forgiveness.';
            }
        }
    </script>
</body>
</html>

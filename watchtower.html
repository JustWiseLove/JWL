<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <title>Watchtower - Just Wise Love</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #e0e0e0; /* Match homeschool.html background */
            color: #333333; /* Consistent dark gray text */
            line-height: 1.6;
        }

        header {
            background-color: #e0e0e0; /* Match background */
            padding: 10px 0;
            text-align: center;
        }

        header .logo {
            margin: 0;
        }

        header .logo a {
            font-family: 'Audiowide', sans-serif;
            font-size: 24px;
            color: #333333; /* Dark gray for header text */
            text-decoration: none;
        }

        .main-section {
            background-color: #e0e0e0; /* Match body background */
            padding: 50px 20px;
            text-align: center;
            color: #333333;
        }

        .article-editor {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto 20px auto;
            background-color: #e0e0e0; /* Match background */
            padding: 5px;
            border-radius: 5px;
        }

        .article-editor textarea {
            width: 100%;
            height: 400px;
            background-color: #e0e0e0; /* Match background */
            color: #333333; /* Dark gray text */
            font-family: Arial, sans-serif;
            font-size: 16px;
            padding: 10px 15px;
            border: 2px solid #666666; /* Grayscale border */
            border-radius: 5px;
            resize: vertical;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            line-height: 1.6;
        }

        .article-editor textarea::placeholder {
            color: #999999; /* Grayscale placeholder */
        }

        .buttons {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            gap: 15px;
            max-width: 600px;
        }

        .submit-btn {
            background-color: #d0d0d0; /* Light gray button */
            color: #333333; /* Dark gray text */
            border: 2px solid #d0d0d0;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #b0b0b0; /* Match hover effect from homeschool.html */
        }

        .output-section {
            background-color: #e0e0e0; /* Match background */
            padding: 20px;
            margin-top: 20px;
            display: none; /* Hidden by default */
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            border: 2px solid #333333; /* Dark gray border */
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .output-section h2 {
            color: #333333;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .output-section h3 {
            color: #333333;
            font-size: 1.2rem;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .output-section p, .output-section li {
            color: #333333;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .output-section ul {
            list-style-type: decimal;
            padding-left: 20px;
        }

        footer {
            background-color: #e0e0e0; /* Match background */
            color: #333333; /* Dark gray text */
            text-align: center;
            padding: 10px 0;
        }

        @media (max-width: 768px) {
            .article-editor textarea {
                height: 300px;
            }

            .submit-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .output-section {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .article-editor textarea {
                height: 200px;
                font-size: 14px;
                padding: 10px;
            }

            .submit-btn {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .output-section {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <h1><a href="watchtower.html">WATCHTOWER</a></h1>
        </div>
    </header>

    <section class="main-section">
        <div class="article-editor">
            <textarea id="articleInput" placeholder="Paste the Watchtower article here..."></textarea>
        </div>
        <div class="buttons">
            <button class="submit-btn" onclick="processArticle()">Submit</button>
        </div>
        <div class="output-section" id="outputSection">
            <h2>Article Summary</h2>
            <p id="summaryOutput"></p>
            <h3>Numerical Questions and Answers</h3>
            <ul id="numericalQuestionsOutput"></ul>
            <h3>Summary Questions and Answers</h3>
            <p id="summaryQuestionsOutput"></p>
        </div>
    </section>

    <footer>
        <p>© 2025 Just Wise Love</p>
    </footer>

    <script>
        function processArticle() {
            const articleText = document.getElementById('articleInput').value.trim();
            const outputSection = document.getElementById('outputSection');
            const summaryOutput = document.getElementById('summaryOutput');
            const numericalQuestionsOutput = document.getElementById('numericalQuestionsOutput');
            const summaryQuestionsOutput = document.getElementById('summaryQuestionsOutput');

            if (!articleText) {
                alert('Please paste a Watchtower article to process.');
                outputSection.style.display = 'none';
                return;
            }

            // Display the output section
            outputSection.style.display = 'block';

            // Step 1: Generate a summary of the article
            const summary = generateSummary(articleText);
            summaryOutput.innerHTML = summary;

            // Step 2: Extract and answer numerical questions
            const numericalQuestions = extractNumericalQuestions(articleText);
            numericalQuestionsOutput.innerHTML = '';
            numericalQuestions.forEach(({ question, answer }) => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${question}</strong><br>${answer}`;
                numericalQuestionsOutput.appendChild(li);
            });

            // Step 3: Extract and answer summary questions
            const summaryQuestions = extractSummaryQuestions(articleText);
            summaryQuestionsOutput.innerHTML = summaryQuestions.map(({ question, answer }) => `<strong>${question}</strong><br>${answer}`).join('<br><br>');
        }

        function generateSummary(articleText) {
            const paragraphs = articleText.split(/\n\s*\n/).filter(p => p.trim());
            const themes = [];
            const scriptureRegex = /\b[A-Za-z]+\s+\d+:\d+\b/g;
            const introPara = paragraphs.find(p => p.match(/^\d+\./)) || '';
            const concludingPara = paragraphs[paragraphs.length - 1] || '';

            const scriptures = articleText.match(scriptureRegex) || [];
            const words = articleText.toLowerCase().split(/\W+/);
            const wordFreq = {};
            words.forEach(word => {
                if (word.length > 4 && !['jehovah', 'jesus', 'bible', 'scriptures'].includes(word)) {
                    wordFreq[word] = (wordFreq[word] || 0) + 1;
                }
            });

            const commonThemes = Object.keys(wordFreq)
                .filter(word => wordFreq[word] > 2)
                .slice(0, 3)
                .join(', ');

            let summary = 'This article focuses on key spiritual lessons and encouragement for Jehovah’s Witnesses. ';
            if (introPara) {
                summary += `It begins by introducing ${introPara.slice(0, 100).replace(/\n/g, ' ')}... `;
            }
            if (commonThemes) {
                summary += `The article emphasizes themes such as ${commonThemes}. `;
            }
            if (scriptures.length > 0) {
                summary += `It references scriptures like ${scriptures.slice(0, 2).join(' and ')} to support its points. `;
            }
            if (concludingPara) {
                summary += `The article concludes by encouraging readers to ${concludingPara.slice(0, 100).replace(/\n/g, ' ')}...`;
            }

            return summary;
        }

        function extractNumericalQuestions(articleText) {
            // Split the article into lines for better question detection
            const lines = articleText.split('\n').filter(line => line.trim());
            const questionRegex = /^\d+\.\s*.*?$/; // Match lines starting with a number and period
            const results = [];

            // Store questions and their associated paragraphs
            let currentQuestion = null;
            let associatedPara = '';

            lines.forEach((line, index) => {
                if (questionRegex.test(line)) {
                    // If we already have a question, process it before starting a new one
                    if (currentQuestion) {
                        const answer = generateAnswer(associatedPara, currentQuestion);
                        results.push({ question: currentQuestion, answer });
                    }
                    // Start a new question
                    currentQuestion = line.trim();
                    associatedPara = ''; // Reset the associated paragraph
                } else if (currentQuestion) {
                    // Accumulate lines into the associated paragraph until the next question
                    associatedPara += (associatedPara ? ' ' : '') + line.trim();
                }
            });

            // Process the last question
            if (currentQuestion) {
                const answer = generateAnswer(associatedPara, currentQuestion);
                results.push({ question: currentQuestion, answer });
            }

            return results;
        }

        function generateAnswer(associatedPara, question) {
            let answer = 'Based on the article, this paragraph highlights key points. ';
            const scriptureRegex = /\b[A-Za-z]+\s+\d+:\d+\b/;
            const scriptureMatch = associatedPara.match(scriptureRegex);

            if (scriptureMatch) {
                const scripture = scriptureMatch[0];
                const scriptureText = getScriptureText(scripture);
                answer += `It references ${scripture}, which states: "${scriptureText}". This teaches us the importance of applying the principle in our lives. `;
            } else {
                answer += `The paragraph emphasizes spiritual lessons, encouraging us to reflect on our faith and actions. `;
            }

            const sentences = associatedPara.split(/(?<=\.)\s+/).filter(s => s.trim());
            if (sentences.length > 0) {
                answer += `Specifically, it mentions ${sentences[0].slice(0, 100).replace(/\n/g, ' ')}...`;
            }

            return answer;
        }

        function extractSummaryQuestions(articleText) {
            const paragraphs = articleText.split(/\n\s*\n/).filter(p => p.trim());
            const summarySectionIndex = paragraphs.findIndex(p => p.toLowerCase().includes('how would you answer') || p.toLowerCase().includes('review') || p.toLowerCase().includes('summary'));
            const summaryQuestions = [];

            if (summarySectionIndex !== -1) {
                const summaryParas = paragraphs.slice(summarySectionIndex + 1);
                const questionRegex = /^[^\d].*?\?/;
                summaryParas.forEach(para => {
                    if (questionRegex.test(para)) {
                        let answer = 'This question encourages deeper reflection on the article’s themes. ';
                        const scriptureRegex = /\b[A-Za-z]+\s+\d+:\d+\b/;
                        const scriptureMatch = para.match(scriptureRegex);

                        if (scriptureMatch) {
                            const scripture = scriptureMatch[0];
                            const scriptureText = getScriptureText(scripture);
                            answer += `It relates to ${scripture}, which says: "${scriptureText}". This reminds us to apply these principles in our daily lives. `;
                        } else {
                            answer += `The article suggests that we consider how the lessons apply to our personal circumstances, such as strengthening our faith or supporting others in the congregation. `;
                        }

                        summaryQuestions.push({ question: para, answer });
                    }
                });
            }

            if (summaryQuestions.length === 0) {
                summaryQuestions.push({
                    question: 'No summary questions found.',
                    answer: 'Please ensure the article includes a review section with summary questions.'
                });
            }

            return summaryQuestions;
        }

        function getScriptureText(scriptureRef) {
            const scriptureMap = {
                'John 3:16': 'For God loved the world so much that he gave his only-begotten Son, so that everyone exercising faith in him might not be destroyed but have everlasting life.',
                'Romans 5:12': 'That is why, just as through one man sin entered into the world and death through sin, and so death spread to all men because they had all sinned—',
                'Psalm 49:7': 'None of them can ever redeem a brother, Nor give to God a ransom for him.',
                'Psalm 49:8': '(For the redemption price of their life is so precious That it is always out of reach);',
                'Romans 5:10': 'For if when we were enemies we became reconciled to God through the death of his Son, how much more we will be saved by his life, now that we have become reconciled.',
                'Matthew 20:28': 'Just as the Son of man came, not to be ministered to, but to minister and to give his life as a ransom in exchange for many.',
                'Hebrews 9:28': 'So also the Christ was offered once for all time to bear the sins of many; and the second time he appears it will be apart from sin, and he will be seen by those earnestly looking for him for their salvation.',
                '1 Peter 2:22': 'He committed no sin, nor was deception found in his mouth.'
            };

            return scriptureMap[scriptureRef] || 'Scripture text not available in this demo. Please refer to the NWT (2013) on JW.ORG for the full text.';
        }
    </script>
</body>
</html>

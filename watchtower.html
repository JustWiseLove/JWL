<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchtower Summary Generator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <style>
        /* Additional styles specific to watchtower.html */
        .input-section {
            text-align: center;
            margin: 20px 0;
        }

        .input-section textarea {
            width: 80%;
            max-width: 800px;
            height: 200px;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 5px;
            background-color: #e0e0e0;
            color: #333;
            resize: none;
            margin: 10px 0;
        }

        .paste-button, .submit-button, .copy-button {
            padding: 10px 20px;
            font-size: 16px;
            font-family: 'Audiowide', sans-serif;
            background-color: #d3d3d3;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 10px;
        }

        .paste-button:hover, .submit-button:hover, .copy-button:hover {
            background-color: #b0b0b0;
        }

        .output-section {
            display: none;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #e0e0e0;
            border-radius: 5px;
            text-align: left;
        }

        .output-section h2 {
            font-family: 'Audiowide', sans-serif;
            color: #333;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
        }

        .output-section p {
            margin: 10px 0;
        }

        .output-section .scripture {
            background-color: #c0c0c0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-style: italic;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="watchtower.html"><h1>WATCHTOWER</h1></a>
        </div>
    </header>

    <main>
        <div class="input-section">
            <button class="paste-button" onclick="pasteArticle()">Paste</button>
            <textarea id="articleInput" placeholder="Paste the Watchtower article here..."></textarea>
            <br>
            <button class="submit-button" onclick="generateStudyGuide()">Submit</button>
        </div>

        <div class="output-section" id="outputSection">
            <div id="studyGuideOutput"></div>
            <button class="copy-button" onclick="copyStudyGuide()">Copy</button>
        </div>
    </main>

    <footer>
        <p>Â© 2025 Just Wise Love</p>
    </footer>

    <script>
        // Paste functionality
        async function pasteArticle() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('articleInput').value = text;
            } catch (err) {
                console.error('Failed to paste: ', err);
                alert('Failed to paste. Please paste manually.');
            }
        }

        // Copy functionality
        function copyStudyGuide() {
            const studyGuideText = document.getElementById('studyGuideOutput').innerText;
            navigator.clipboard.writeText(studyGuideText).then(() => {
                alert('Study guide copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy. Please copy manually.');
            });
        }

        // Study guide generation
        function generateStudyGuide() {
            const articleText = document.getElementById('articleInput').value.trim();
            if (!articleText) {
                alert('Please paste a Watchtower article before submitting.');
                return;
            }

            // Split the article into lines for parsing
            const lines = articleText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

            // Extract the title (usually the first line with a date in parentheses)
            let title = '';
            for (let line of lines) {
                if (line.includes('(') && line.includes(')')) {
                    title = line.split('(')[0].trim();
                    break;
                }
            }
            if (!title) title = 'Unknown Watchtower Article';

            // Extract the focus statement (often after the title, before numbered sections)
            let focus = '';
            let focusFound = false;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].match(/^\d+\./) || lines[i].match(/^\d+\s/)) break; // Stop at numbered sections
                if (lines[i].toLowerCase().includes('this article') || lines[i].toLowerCase().includes('we will')) {
                    focus = lines[i];
                    focusFound = true;
                    break;
                }
            }
            if (!focusFound) focus = 'This article discusses key spiritual principles for Christian living.';

            // Extract questions and answers
            const points = [];
            let currentQuestion = '';
            let currentAnswer = [];
            let currentScripture = '';
            let inQuestionSection = false;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                // Identify questions (lines starting with a number and a period or space)
                if (line.match(/^\d+\./) || line.match(/^\d+\s/)) {
                    if (currentQuestion) {
                        // Save the previous question and answer
                        let answerText = currentAnswer.join(' ').trim();
                        // Limit answer to 50 words
                        const words = answerText.split(/\s+/);
                        if (words.length > 50) {
                            answerText = words.slice(0, 50).join(' ') + '...';
                        }
                        points.push({
                            question: currentQuestion,
                            answer: answerText,
                            scripture: currentScripture
                        });
                    }
                    currentQuestion = line.trim();
                    currentAnswer = [];
                    currentScripture = '';
                    inQuestionSection = true;
                    continue;
                }

                if (inQuestionSection) {
                    // Look for scriptures (e.g., "Psalm 23:1")
                    const scriptureMatch = line.match(/(?:Genesis|Exodus|Leviticus|Numbers|Deuteronomy|Joshua|Judges|Ruth|1\sSamuel|2\sSamuel|1\sKings|2\sKings|1\sChronicles|2\sChronicles|Ezra|Nehemiah|Esther|Job|Psalm|Proverbs|Ecclesiastes|Song\sOf\sSolomon|Isaiah|Jeremiah|Lamentations|Ezekiel|Daniel|Hosea|Joel|Amos|Obadiah|Jonah|Micah|Nahum|Habakkuk|Zephaniah|Haggai|Zechariah|Malachi|Matthew|Mark|Luke|John|Acts|Romans|1\sCorinthians|2\sCorinthians|Galatians|Ephesians|Philippians|Colossians|1\sThessalonians|2\sThessalonians|1\sTimothy|2\sTimothy|Titus|Philemon|Hebrews|James|1\sPeter|2\sPeter|1\sJohn|2\sJohn|3\sJohn|Jude|Revelation)\s\d+:\d+(-\d+)?/i);
                    if (scriptureMatch) {
                        currentScripture = `${scriptureMatch[0]} (NWT)`;
                        // Simulate scripture text (since I can't fetch from JW.ORG)
                        currentScripture += `: "${scriptureMatch[0]} - Scripture text not available. Please refer to JW.ORG for the full text."`;
                    } else {
                        currentAnswer.push(line);
                    }
                }
            }

            // Add the last question and answer
            if (currentQuestion) {
                let answerText = currentAnswer.join(' ').trim();
                const words = answerText.split(/\s+/);
                if (words.length > 50) {
                    answerText = words.slice(0, 50).join(' ') + '...';
                }
                points.push({
                    question: currentQuestion,
                    answer: answerText,
                    scripture: currentScripture
                });
            }

            // If no points were found, add a placeholder
            if (points.length === 0) {
                points.push({
                    question: "1. What is the main theme of the article?",
                    answer: "The article discusses key spiritual lessons. Please ensure the article text includes numbered questions for a detailed study guide.",
                    scripture: ''
                });
            }

            // Generate the study guide HTML
            let studyGuideHtml = `<h2>${title}</h2>`;
            studyGuideHtml += `<p><strong>FOCUS:</strong> ${focus}</p>`;
            points.forEach(point => {
                studyGuideHtml += `<p><strong>${point.question}</strong></p>`;
                studyGuideHtml += `<p>${point.answer}</p>`;
                if (point.scripture) {
                    studyGuideHtml += `<div class="scripture"><p>${point.scripture}</p></div>`;
                }
            });

            // Display the study guide
            document.getElementById('studyGuideOutput').innerHTML = studyGuideHtml;
            document.getElementById('outputSection').style.display = 'block';
        }
    </script>
</body>
</html>

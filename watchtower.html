<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchtower Study Guide Generator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <style>
        /* Additional styles specific to watchtower.html */
        .input-section {
            text-align: center;
            margin: 20px 0;
        }

        .input-section textarea {
            width: 80%;
            max-width: 800px;
            height: 200px;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 5px;
            background-color: #e0e0e0;
            color: #333;
            resize: none;
            margin: 10px 0;
        }

        .paste-button, .submit-button, .copy-button {
            padding: 10px 20px;
            font-size: 16px;
            font-family: 'Audiowide', sans-serif;
            background-color: #d3d3d3;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 10px;
            color: #00cc00; /* Green text color for buttons */
        }

        .paste-button:hover, .submit-button:hover, .copy-button:hover {
            background-color: #b0b0b0;
        }

        .output-section {
            display: none;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #e0e0e0;
            border-radius: 5px;
            text-align: left;
        }

        .output-section h2 {
            font-family: 'Audiowide', sans-serif;
            color: #333;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
        }

        .output-section h3 {
            font-family: 'Audiowide', sans-serif;
            color: #333;
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .output-section p {
            margin: 10px 0;
        }

        .output-section .scripture {
            background-color: #c0c0c0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-style: italic;
            text-align: center;
        }

        .summary-questions {
            margin-top: 20px;
        }

        .summary-questions ul {
            list-style-type: none;
            padding: 0;
        }

        .summary-questions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="watchtower.html"><h1>WATCHTOWER</h1></a>
        </div>
    </header>

    <main>
        <div class="input-section">
            <button class="paste-button" onclick="pasteArticle()">Paste</button>
            <textarea id="articleInput" placeholder="Paste the Watchtower article here..."></textarea>
            <br>
            <button class="submit-button" onclick="generateStudyGuide()">Submit</button>
        </div>

        <div class="output-section" id="outputSection">
            <div id="studyGuideOutput"></div>
            <button class="copy-button" onclick="copyStudyGuide()">Copy</button>
        </div>
    </main>

    <footer>
        <p>© 2025 Just Wise Love</p>
    </footer>

    <script>
        // Paste functionality
        async function pasteArticle() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('articleInput').value = text;
            } catch (err) {
                console.error('Failed to paste: ', err);
                alert('Failed to paste. Please paste manually.');
            }
        }

        // Copy functionality
        function copyStudyGuide() {
            const studyGuideText = document.getElementById('studyGuideOutput').innerText;
            navigator.clipboard.writeText(studyGuideText).then(() => {
                alert('Study guide copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy. Please copy manually.');
            });
        }

        // Study guide generation
        function generateStudyGuide() {
            const articleText = document.getElementById('articleInput').value.trim();
            if (!articleText) {
                alert('Please paste a Watchtower article before submitting.');
                return;
            }

            // Split the article into lines for parsing
            const lines = articleText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

            // Extract the title (look for a line before "Your answer" or a line with parentheses)
            let title = '';
            let titleFound = false;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].toLowerCase() === 'your answer') {
                    // Look backwards for the title
                    for (let j = i - 1; j >= 0; j--) {
                        if (lines[j].match(/^\d+[-–]\d+\./) || lines[j].match(/^\d+\./)) continue; // Skip questions
                        if (lines[j] && !lines[j].toLowerCase().startsWith('focus:') && !lines[j].match(/^\d+\s/)) {
                            title = lines[j];
                            titleFound = true;
                            break;
                        }
                    }
                    break;
                }
            }
            if (!titleFound) {
                // Fallback: Look for a line with parentheses
                for (let line of lines) {
                    if (line.includes('(') && line.includes(')')) {
                        title = line.split('(')[0].trim();
                        break;
                    }
                }
            }
            if (!title) title = 'Unknown Watchtower Article';

            // Extract the focus statement
            let focus = '';
            let focusFound = false;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].toLowerCase().startsWith('focus:')) {
                    focus = lines[i].replace(/^FOCUS:/i, '').trim();
                    focusFound = true;
                    break;
                }
            }
            if (!focusFound) {
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].match(/^\d+[-–]\d+\./) || lines[i].match(/^\d+\./)) break;
                    if (lines[i].toLowerCase().includes('this article') || lines[i].toLowerCase().includes('we will')) {
                        focus = lines[i];
                        focusFound = true;
                        break;
                    }
                }
            }
            if (!focusFound) focus = 'This article discusses key spiritual principles for Christian living.';

            // Extract questions and answers
            const points = [];
            let currentQuestion = '';
            let currentAnswerLines = [];
            let inQuestionSection = false;
            let questionNumberPattern = /^(\d+[-–]\d+|\d+)\.\s(.+)/; // Match "1-2." or "1."
            let paragraphNumberPattern = /^\d+\s/; // Match paragraph numbers like "2 "

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                // Stop parsing questions if we hit the "How Would You Answer?" section
                if (line.toLowerCase().includes('how would you answer')) {
                    break;
                }

                // Identify questions
                let questionMatch = line.match(questionNumberPattern);
                if (questionMatch) {
                    if (currentQuestion) {
                        // Process the previous question and answer
                        let rawAnswer = currentAnswerLines.join(' ').trim();
                        let summarizedAnswer = summarizeAnswer(rawAnswer);
                        points.push({
                            question: currentQuestion,
                            answer: summarizedAnswer.text,
                            scripture: summarizedAnswer.scripture
                        });
                    }
                    currentQuestion = questionMatch[0];
                    currentAnswerLines = [];
                    inQuestionSection = true;
                    continue;
                }

                if (inQuestionSection) {
                    // Check if the line is a new paragraph number (e.g., "2 ")
                    if (line.match(paragraphNumberPattern)) {
                        currentAnswerLines.push(line.replace(paragraphNumberPattern, '').trim());
                    } else if (line.match(/^\d+[-–]\d+\./) || line.match(/^\d+\./)) {
                        // Start of a new question
                        let rawAnswer = currentAnswerLines.join(' ').trim();
                        let summarizedAnswer = summarizeAnswer(rawAnswer);
                        points.push({
                            question: currentQuestion,
                            answer: summarizedAnswer.text,
                            scripture: summarizedAnswer.scripture
                        });
                        currentQuestion = line;
                        currentAnswerLines = [];
                    } else {
                        currentAnswerLines.push(line);
                    }
                }
            }

            // Add the last question and answer
            if (currentQuestion) {
                let rawAnswer = currentAnswerLines.join(' ').trim();
                let summarizedAnswer = summarizeAnswer(rawAnswer);
                points.push({
                    question: currentQuestion,
                    answer: summarizedAnswer.text,
                    scripture: summarizedAnswer.scripture
                });
            }

            // Extract "How Would You Answer?" summary questions
            let summaryQuestions = [];
            let inSummarySection = false;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                if (line.toLowerCase().includes('how would you answer')) {
                    inSummarySection = true;
                    continue;
                }
                if (inSummarySection) {
                    // Look for questions (often bullet points, numbers, or plain text)
                    if (line.match(/^\d+\.\s/) || line.match(/^\d+[-–]\d+\.\s/) || line.match(/^\s*[-•]\s/) || (line.trim().endsWith('?') && !line.match(/^\d+\s/))) {
                        let questionText = line.trim();
                        // Clean up bullet points or numbering if present
                        questionText = questionText.replace(/^\s*[-•]\s/, '').replace(/^\d+\.\s/, '').replace(/^\d+[-–]\d+\.\s/, '');
                        summaryQuestions.push(questionText);
                    }
                }
            }

            // If no points were found, add a placeholder
            if (points.length === 0) {
                points.push({
                    question: "1. What is the main theme of the article?",
                    answer: "The article discusses key spiritual lessons. Please ensure the article text includes numbered questions for a detailed study guide.",
                    scripture: ''
                });
            }

            // Generate the study guide HTML
            let studyGuideHtml = `<h2>${title}</h2>`;
            studyGuideHtml += `<p><strong>FOCUS:</strong> ${focus}</p>`;
            points.forEach(point => {
                studyGuideHtml += `<p><strong>${point.question}</strong></p>`;
                studyGuideHtml += `<p>${point.answer}</p>`;
                if (point.scripture) {
                    studyGuideHtml += `<div class="scripture"><p>${point.scripture}</p></div>`;
                }
            });

            // Add summary questions if they exist
            if (summaryQuestions.length > 0) {
                studyGuideHtml += `<div class="summary-questions">`;
                studyGuideHtml += `<h3>Summary Questions</h3>`;
                studyGuideHtml += `<ul>`;
                summaryQuestions.forEach(question => {
                    studyGuideHtml += `<li>${question}</li>`;
                });
                studyGuideHtml += `</ul>`;
                studyGuideHtml += `</div>`;
            }

            // Display the study guide
            document.getElementById('studyGuideOutput').innerHTML = studyGuideHtml;
            document.getElementById('outputSection').style.display = 'block';
        }

        // Function to summarize the answer in my own words and extract quoted scriptures
        function summarizeAnswer(rawAnswer) {
            // Split the raw answer into sentences
            const sentences = rawAnswer.split(/(?<=\.)\s+/).filter(s => s.trim().length > 0);
            let summary = '';
            let scriptureText = '';

            // Summarize the content in my own words
            if (sentences.length > 0) {
                // Analyze the content to create a concise summary
                let keyPoints = [];
                sentences.forEach(sentence => {
                    if (sentence.toLowerCase().includes('young man') && sentence.toLowerCase().includes('wealthy')) {
                        keyPoints.push('A young man from a wealthy family faces tragedy.');
                    }
                    if (sentence.toLowerCase().includes('parents') && sentence.toLowerCase().includes('killed')) {
                        keyPoints.push('His parents die in an accident, causing him grief.');
                    }
                    if (sentence.toLowerCase().includes('adam and eve') && sentence.toLowerCase().includes('paradise')) {
                        keyPoints.push('Adam and Eve lived perfectly in Paradise.');
                    }
                    if (sentence.toLowerCase().includes('lost') && sentence.toLowerCase().includes('everlasting life')) {
                        keyPoints.push('They lost their perfect life and home.');
                    }
                });

                // Combine key points into a summary, limited to 50 words
                summary = keyPoints.join(' ').trim();
                const words = summary.split(/\s+/);
                if (words.length > 50) {
                    summary = words.slice(0, 50).join(' ') + '...';
                }
            }

            if (!summary) {
                summary = 'The paragraph discusses a scenario illustrating a spiritual lesson.';
            }

            // Extract quoted scriptures
            sentences.forEach(sentence => {
                const quoteMatch = sentence.match(/"([^"]+)"\s*(Genesis|Exodus|Leviticus|Numbers|Deuteronomy|Joshua|Judges|Ruth|1\sSamuel|2\sSamuel|1\sKings|2\sKings|1\sChronicles|2\sChronicles|Ezra|Nehemiah|Esther|Job|Psalm|Proverbs|Ecclesiastes|Song\sOf\sSolomon|Isaiah|Jeremiah|Lamentations|Ezekiel|Daniel|Hosea|Joel|Amos|Obadiah|Jonah|Micah|Nahum|Habakkuk|Zephaniah|Haggai|Zechariah|Malachi|Matthew|Mark|Luke|John|Acts|Romans|1\sCorinthians|2\sCorinthians|Galatians|Ephesians|Philippians|Colossians|1\sThessalonians|2\sThessalonians|1\sTimothy|2\sTimothy|Titus|Philemon|Hebrews|James|1\sPeter|2\sPeter|1\sJohn|2\sJohn|3\sJohn|Jude|Revelation)\s\d+:\d+(-\d+)?/i);
                if (quoteMatch) {
                    const quote = quoteMatch[1];
                    const reference = quoteMatch[0].match(/(Genesis|Exodus|Leviticus|Numbers|Deuteronomy|Joshua|Judges|Ruth|1\sSamuel|2\sSamuel|1\sKings|2\sKings|1\sChronicles|2\sChronicles|Ezra|Nehemiah|Esther|Job|Psalm|Proverbs|Ecclesiastes|Song\sOf\sSolomon|Isaiah|Jeremiah|Lamentations|Ezekiel|Daniel|Hosea|Joel|Amos|Obadiah|Jonah|Micah|Nahum|Habakkuk|Zephaniah|Haggai|Zechariah|Malachi|Matthew|Mark|Luke|John|Acts|Romans|1\sCorinthians|2\sCorinthians|Galatians|Ephesians|Philippians|Colossians|1\sThessalonians|2\sThessalonians|1\sTimothy|2\sTimothy|Titus|Philemon|Hebrews|James|1\sPeter|2\sPeter|1\sJohn|2\sJohn|3\sJohn|Jude|Revelation)\s\d+:\d+(-\d+)?/i)[0];
                    scriptureText += `${reference} (NWT): "${quote}"\n`;
                }
            });

            return {
                text: summary,
                scripture: scriptureText.trim()
            };
        }
    </script>
</body>
</html>

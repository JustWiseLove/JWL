<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>copedoc</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #FFD700 0%, #8B4513 100%);
            --card-bg: #F5F5F5;
            --gold: #DAA520;
            --brown: #5C4033;
            --gray: #333333;
            --shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--gray);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: var(--brown);
            padding: 15px;
            border-radius: 8px;
        }

        .header-img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 3.5rem;
            color: var(--gold);
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .motto {
            font-size: 1.4rem;
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tagline {
            font-size: 1.1rem;
            color: #E0E0E0;
            font-style: italic;
        }

        .nav-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: var(--brown);
            color: #E0E0E0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: var(--gold);
            color: var(--gray);
        }

        .nav-btn.active {
            background: var(--gold);
            color: var(--gray);
        }

        .section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 16px;
            color: var(--brown);
            font-weight: 600;
        }

        .profile-section, .score-section, .intro-section, .search-section {
            display: none;
        }

        .profile-section.show, .score-section.show, .intro-section.show, .search-section.show {
            display: block;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }

        .profile-icon {
            font-size: 2rem;
        }

        .profile-details {
            flex-grow: 1;
        }

        .profile-edit {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #D3D3D3;
        }

        .profile-edit.show {
            display: block;
        }

        .profile-edit label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--brown);
        }

        .profile-edit input, .profile-edit textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #D3D3D3;
            border-radius: 8px;
            font-size: 1rem;
        }

        .profile-edit button {
            padding: 10px 20px;
            background: var(--brown);
            color: #E0E0E0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .profile-edit button:hover {
            background: var(--gold);
            color: var(--gray);
        }

        .score-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .score-guide, .score-counter, .badges-earned, .badge-checklist {
            margin-bottom: 10px;
        }

        .score-guide ul {
            list-style-type: disc;
            margin-left: 20px;
        }

        .score-guide li {
            margin-bottom: 8px;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            background: var(--gold);
            color: var(--gray);
            border-radius: 12px;
            font-size: 0.9rem;
            margin-right: 5px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .checklist-item.completed::before {
            content: '‚úî';
            color: var(--brown);
            font-weight: bold;
        }

        .checklist-item:not(.completed)::before {
            content: '‚¨ú';
            font-size: 1.2rem;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 16px;
            border: 2px solid #D3D3D3;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-input::placeholder {
            color: #A9A9A9;
        }

        .search-results {
            margin-top: 16px;
        }

        .no-results {
            color: #666;
            font-style: italic;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .emoji-btn {
            font-size: 3.5rem;
            padding: 16px;
            border: 3px solid transparent;
            border-radius: 16px;
            background: #D3D3D3;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .emoji-btn.selected {
            border-color: var(--brown);
            transform: scale(1.08);
            background: var(--gold);
        }

        .tags-container {
            max-height: 320px;
            min-height: 280px;
            overflow-y: auto;
            padding: 8px;
            border: 2px dashed #D3D3D3;
            border-radius: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            padding: 8px 14px;
            background: #D3D3D3;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .tag:hover {
            background: #B0B0B0;
        }

        .tag.selected {
            background: var(--brown);
            color: #E0E0E0;
        }

        .editor-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 8px 12px;
            background: #D3D3D3;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: var(--gold);
            transition: 0.2s;
        }

        .tool-btn:hover, .tool-btn.active {
            background: var(--brown);
            color: #E0E0E0;
        }

        #journal {
            min-height: 200px;
            max-height: 400px;
            padding: 16px;
            border: 2px solid #D3D3D3;
            border-radius: 12px;
            outline: none;
            resize: vertical;
            font-size: 1rem;
            line-height: 1.7;
        }

        #journal:empty:before {
            content: 'Start writing here...';
            color: #A9A9A9;
            font-style: italic;
        }

        .submit-section {
            text-align: center;
            margin: 30px 0;
        }

        #submit-btn {
            padding: 14px 32px;
            font-size: 1.1rem;
            background: var(--brown);
            color: #E0E0E0;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        #submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        #submit-btn:disabled {
            background: #A9A9A9;
            cursor: not-allowed;
            transform: none;
        }

        .ai-response {
            margin-top: 20px;
            padding: 16px;
            background: #F5F5F5;
            border-left: 4px solid var(--brown);
            border-radius: 8px;
            font-style: italic;
            display: none;
        }

        .history {
            margin-top: 40px;
        }

        .entry-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: 0.2s;
        }

        .entry-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .entry-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .entry-emoji {
            font-size: 1.8rem;
        }

        .entry-mood {
            color: var(--brown);
        }

        .entry-preview {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .entry-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }

        .entry-tag {
            background: var(--gold);
            color: var(--gray);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .entry-time {
            font-size: 0.8rem;
            color: #999;
        }

        .entry-full {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #D3D3D3;
        }

        .entry-full.show {
            display: block;
        }

        .entry-text {
            margin-bottom: 12px;
            line-height: 1.7;
        }

        .ai-full {
            background: #F5F5F5;
            padding: 12px;
            border-radius: 8px;
            font-style: italic;
            border-left: 3px solid var(--brown);
        }

        @media (max-width: 600px) {
            .emoji-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            h1 {
                font-size: 2.8rem;
            }
            .container {
                padding: 12px;
            }
            .header-img {
                max-width: 80%;
            }
        }

        .thinking {
            text-align: center;
            padding: 20px;
            color: var(--brown);
            font-style: italic;
            display: none;
        }

        .intro-text {
            font-style: italic;
            color: #666;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="rocks.PNG"><img src="rocks.PNG" alt="Sunset Rocks" class="header-img"></a>
            <h1>copedoc</h1>
            <div class="motto">Personal Writing Resource</div>
            <p class="tagline">Feel. Reflect. Grow.</p>
        </header>

        <div class="nav-bar">
            <button class="nav-btn active" id="posts-btn">Posts</button>
            <button class="nav-btn" id="score-btn">Score</button>
            <button class="nav-btn" id="profile-btn">Profile</button>
            <button class="nav-btn" id="search-btn">Search</button>
        </div>

        <div class="intro-section section" id="intro-section">
            <h2 class="section-title">Mission</h2>
            <p class="intro-text">Using a proven method to help you process emotions through daily journaling, fostering reflection and personal growth.</p>
        </div>

        <div class="profile-section section" id="profile-section">
            <h2 class="section-title">Your Profile</h2>
            <div class="profile-header" id="profile-header">
                <span class="profile-icon" id="profile-icon">üî•</span>
                <div class="profile-details">
                    <div id="profile-username">User</div>
                    <div id="profile-motto" style="font-style: italic;">Personal Writing Resource</div>
                </div>
            </div>
            <div class="profile-edit" id="profile-edit">
                <label for="edit-icon">Profile Icon</label>
                <input type="text" id="edit-icon" placeholder="Enter emoji or icon" maxlength="2">
                <label for="edit-username">Username</label>
                <input type="text" id="edit-username" placeholder="Enter username">
                <label for="edit-motto">Motto</label>
                <input type="text" id="edit-motto" placeholder="Enter motto">
                <label for="edit-reminder">Favorite Reminder</label>
                <textarea id="edit-reminder" placeholder="Favorite Reminder"></textarea>
                <label for="edit-goals">Personal Goals</label>
                <textarea id="edit-goals" placeholder="Personal Goals"></textarea>
                <button id="save-profile">Save Profile</button>
            </div>
        </div>

        <div class="score-section section" id="score-section">
            <h2 class="section-title">Your Score & Badges</h2>
            <div class="score-content">
                <div class="score-counter">
                    <h3>Your Score</h3>
                    <div>Total Points: <span id="total-points">0</span></div>
                    <div>Streak: <span id="streak">0</span> day(s)</div>
                </div>
                <div class="badges-earned">
                    <h3>Badges Earned</h3>
                    <div id="badges">None</div>
                </div>
                <div class="badge-checklist">
                    <h3>Badge Checklist</h3>
                    <div id="checklist">
                        <div class="checklist-item" id="check-username">Change Username</div>
                        <div class="checklist-item" id="check-motto">Change Motto</div>
                        <div class="checklist-item" id="check-daily">Post Daily</div>
                    </div>
                </div>
                <div class="score-guide">
                    <h3>Personal Quests</h3>
                    <ul>
                        <li>Post daily: +50 points per day</li>
                        <li>Write longer journal entries: +1 point per 10 characters (min. 10)</li>
                        <li>Complete profile fields: +100 points per unique field (username, motto)</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="search-section section" id="search-section">
            <h2 class="section-title">Search Your Posts</h2>
            <input type="text" id="search-input" class="search-input" placeholder="Search My Posts">
            <div class="search-results" id="search-results"></div>
        </div>

        <div class="posts-section" id="posts-section">
            <div class="section">
                <h2 class="section-title">How Do You Feel?</h2>
                <div class="emoji-grid">
                    <div class="emoji-btn" data-mood="Happy">üòÅ</div>
                    <div class="emoji-btn" data-mood="Neutral">üòê</div>
                    <div class="emoji-btn" data-mood="Sad">üò¢</div>
                    <div class="emoji-btn" data-mood="Suprised">ü§Ø</div>
                    <div class="emoji-btn" data-mood="Angry">üò°</div>
                    <div class="emoji-btn" data-mood="Cool">üòé</div>
                    <div class="emoji-btn" data-mood="Tired">üò¥</div>
                    <div class="emoji-btn" data-mood="Thinking">ü§î</div>
                    <div class="emoji-btn" data-mood="Loved">ü•∞</div>
                    <div class="emoji-btn" data-mood="Calm">üòä</div>
                    <div class="emoji-btn" data-mood="Confused">üòï</div>
                    <div class="emoji-btn" data-mood="Silly">ü§™</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">What Caused It?</h2>
                <div class="tags-container" id="tags-container">
                    <div class="tag" data-tag="Work">Work</div>
                    <div class="tag" data-tag="Boss">Boss</div>
                    <div class="tag" data-tag="Deadline">Deadline</div>
                    <div class="tag" data-tag="Money">Money</div>
                    <div class="tag" data-tag="Bills">Bills</div>
                    <div class="tag" data-tag="Family">Family</div>
                    <div class="tag" data-tag="Parents">Parents</div>
                    <div class="tag" data-tag="Kids">Kids</div>
                    <div class="tag" data-tag="Partner">Partner</div>
                    <div class="tag" data-tag="Friends">Friends</div>
                    <div class="tag" data-tag="Lonely">Lonely</div>
                    <div class="tag" data-tag="Health">Health</div>
                    <div class="tag" data-tag="Sleep">Sleep</div>
                    <div class="tag" data-tag="Diet">Diet</div>
                    <div class="tag" data-tag="Exercise">Exercise</div>
                    <div class="tag" data-tag="Future">Future</div>
                    <div class="tag" data-tag="AI Job Loss">AI Job Loss</div>
                    <div class="tag" data-tag="Career">Career</div>
                    <div class="tag" data-tag="School">School</div>
                    <div class="tag" data-tag="Exams">Exams</div>
                    <div class="tag" data-tag="News">News</div>
                    <div class="tag" data-tag="Social Media">Social Media</div>
                    <div class="tag" data-tag="Comparison">Comparison</div>
                    <div class="tag" data-tag="Overwhelmed">Overwhelmed</div>
                    <div class="tag" data-tag="Burnout">Burnout</div>
                    <div class="tag" data-tag="Traffic">Traffic</div>
                    <div class="tag" data-tag="Weather">Weather</div>
                    <div class="tag" data-tag="Noise">Noise</div>
                    <div class="tag" data-tag="Memories">Memories</div>
                    <div class="tag" data-tag="Change">Change</div>
                    <div class="tag" data-tag="Routine">Routine</div>
                    <div class="tag" data-tag="Hobbies">Hobbies</div>
                    <div class="tag" data-tag="Relationships">Relationships</div>
                    <div class="tag" data-tag="Pets">Pets</div>
                    <div class="tag" data-tag="Travel">Travel</div>
                    <div class="tag" data-tag="Technology">Technology</div>
                    <div class="tag" data-tag="Creativity">Creativity</div>
                    <div class="tag" data-tag="Finances">Finances</div>
                    <div class="tag" data-tag="Self-Esteem">Self-Esteem</div>
                    <div class="tag" data-tag="Time Management">Time Management</div>
                    <div class="tag" data-tag="Other">Other</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Write It Out</h2>
                <div class="editor-toolbar">
                    <button class="tool-btn" data-cmd="bold">B</button>
                    <button class="tool-btn" data-cmd="italic">I</button>
                    <button class="tool-btn" data-cmd="underline">U</button>
                </div>
                <div id="journal" contenteditable="true"></div>
            </div>

            <div class="submit-section">
                <button id="submit-btn" disabled>Save & Get AI Support</button>
                <div class="thinking" id="thinking">AI is thinking...</div>
                <div class="ai-response" id="ai-response"></div>
            </div>

            <div class="history" id="history" style="display: none;">
                <div class="section">
                    <h2 class="section-title">Your Journal History</h2>
                    <div id="entries-container"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const emojis = {
            'üòÅ': 'Happy',
            'üòê': 'Neutral',
            'üò¢': 'Sad',
            'ü§Ø': 'Suprised',
            'üò°': 'Angry',
            'üòé': 'Cool',
            'üò¥': 'Tired',
            'ü§î': 'Thinking',
            'ü•∞': 'Loved',
            'üòä': 'Calm',
            'üòï': 'Confused',
            'ü§™': 'Silly'
        };

        let selectedMood = null;
        let selectedEmoji = null;
        let selectedTags = [];

        // DOM Elements
        const postsBtn = document.getElementById('posts-btn');
        const scoreBtn = document.getElementById('score-btn');
        const profileBtn = document.getElementById('profile-btn');
        const searchBtn = document.getElementById('search-btn');
        const introSection = document.getElementById('intro-section');
        const profileSection = document.getElementById('profile-section');
        const scoreSection = document.getElementById('score-section');
        const searchSection = document.getElementById('search-section');
        const postsSection = document.getElementById('posts-section');
        const profileHeader = document.getElementById('profile-header');
        const profileEdit = document.getElementById('profile-edit');
        const profileIcon = document.getElementById('profile-icon');
        const profileUsername = document.getElementById('profile-username');
        const profileMotto = document.getElementById('profile-motto');
        const editIcon = document.getElementById('edit-icon');
        const editUsername = document.getElementById('edit-username');
        const editMotto = document.getElementById('edit-motto');
        const editReminder = document.getElementById('edit-reminder');
        const editGoals = document.getElementById('edit-goals');
        const saveProfile = document.getElementById('save-profile');
        const totalPointsEl = document.getElementById('total-points');
        const streakEl = document.getElementById('streak');
        const badgesEl = document.getElementById('badges');
        const checklist = document.getElementById('checklist');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const emojiBtns = document.querySelectorAll('.emoji-btn');
        const tagBtns = document.querySelectorAll('.tag');
        const journal = document.getElementById('journal');
        const submitBtn = document.getElementById('submit-btn');
        const thinking = document.getElementById('thinking');
        const aiResponse = document.getElementById('ai-response');
        const history = document.getElementById('history');
        const entriesContainer = document.getElementById('entries-container');

        // Load Profile
        function loadProfile() {
            const profile = JSON.parse(localStorage.getItem('copedocProfile') || '{}');
            profileIcon.textContent = profile.icon || 'üî•';
            profileUsername.textContent = profile.username || 'User';
            profileMotto.textContent = profile.motto || 'Personal Writing Resource';
            editIcon.value = profile.icon || 'üî•';
            editUsername.value = profile.username || 'User';
            editMotto.value = profile.motto || 'Personal Writing Resource';
            editReminder.value = profile.reminder || 'You are enough just as you are.';
            editGoals.value = profile.goals || 'Practice self-care daily.\nSet one achievable goal each week.';
        }

        // Save Profile
        saveProfile.addEventListener('click', () => {
            const profile = {
                icon: editIcon.value || 'üî•',
                username: editUsername.value || 'User',
                motto: editMotto.value || 'Personal Writing Resource',
                reminder: editReminder.value || 'You are enough just as you are.',
                goals: editGoals.value || 'Practice self-care daily.\nSet one achievable goal each week.'
            };
            localStorage.setItem('copedocProfile', JSON.stringify(profile));
            profileIcon.textContent = profile.icon;
            profileUsername.textContent = profile.username;
            profileMotto.textContent = profile.motto;

            // Award badges
            const pointsData = JSON.parse(localStorage.getItem('copedocPointsData') || '{}');
            if (!pointsData.badges) pointsData.badges = [];
            if (profile.username !== 'User' && !pointsData.badges.includes('username')) {
                pointsData.badges.push('username');
                pointsData.points = (pointsData.points || 0) + 100;
            }
            if (profile.motto !== 'Personal Writing Resource' && !pointsData.badges.includes('motto')) {
                pointsData.badges.push('motto');
                pointsData.points = (pointsData.points || 0) + 100;
            }
            localStorage.setItem('copedocPointsData', JSON.stringify(pointsData));
            updatePointsDisplay();
            profileEdit.classList.remove('show');
        });

        // Load Points and Streak
        function loadPoints() {
            const pointsData = JSON.parse(localStorage.getItem('copedocPointsData') || '{}');
            const entries = JSON.parse(localStorage.getItem('copedocEntries') || '[]');
            const today = new Date().toISOString().split('T')[0];
            const lastEntryDate = entries[0]?.timestamp?.split('T')[0] || '';
            let streak = pointsData.streak || 0;

            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];

            if (lastEntryDate === today) {
                // Already posted today
            } else if (lastEntryDate === yesterdayStr) {
                // Posted yesterday
            } else {
                streak = 0;
            }

            pointsData.streak = streak;
            localStorage.setItem('copedocPointsData', JSON.stringify(pointsData));
            updatePointsDisplay();
        }

        function updatePointsDisplay() {
            const pointsData = JSON.parse(localStorage.getItem('copedocPointsData') || '{}');
            totalPointsEl.textContent = pointsData.points || 0;
            streakEl.textContent = pointsData.streak || 0;
            const badges = pointsData.badges || [];
            const badgeIcons = {
                'username': 'üëë Username Crown',
                'motto': 'ü•á Motto Medal',
                'daily': 'üèÜ Daily Renewal Award'
            };
            badgesEl.innerHTML = badges.length > 0
                ? badges.map(b => `<span class="badge">${badgeIcons[b]}</span>`).join(' ')
                : 'None';

            // Update checklist
            checklist.querySelector('#check-username').classList.toggle('completed', badges.includes('username'));
            checklist.querySelector('#check-motto').classList.toggle('completed', badges.includes('motto'));
            checklist.querySelector('#check-daily').classList.toggle('completed', badges.includes('daily'));
        }

        // Search Functionality
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            const entries = JSON.parse(localStorage.getItem('copedocEntries') || '[]');
            searchResults.innerHTML = '';

            if (query === '') {
                searchResults.innerHTML = '<div class="no-results">Enter a keyword to search your posts.</div>';
                return;
            }

            const filteredEntries = entries.filter(entry => {
                const text = entry.text.replace(/<[^>]*>/g, '').toLowerCase();
                const mood = entry.mood.toLowerCase();
                const tags = entry.tags.map(tag => tag.toLowerCase());
                return mood.includes(query) || tags.some(tag => tag.includes(query)) || text.includes(query);
            });

            if (filteredEntries.length === 0) {
                searchResults.innerHTML = '<div class="no-results">No posts match your search.</div>';
                return;
            }

            filteredEntries.forEach(entry => {
                const card = document.createElement('div');
                card.className = 'entry-card';
                card.innerHTML = `
                    <div class="entry-header">
                        <span class="entry-emoji">${entry.emoji}</span>
                        <span class="entry-mood">${entry.mood}</span>
                    </div>
                    <div class="entry-preview">${entry.text.replace(/<[^>]*>/g, '').substring(0, 60)}...</div>
                    <div class="entry-tags">
                        ${entry.tags.map(tag => `<span class="entry-tag">${tag}</span>`).join('')}
                    </div>
                    <div class="entry-time">${new Date(entry.timestamp).toLocaleString()}</div>
                    <div class="entry-full">
                        <div class="entry-text">${entry.text}</div>
                        <div class="ai-full">${entry.aiResponse}</div>
                    </div>
                `;

                card.addEventListener('click', () => {
                    const full = card.querySelector('.entry-full');
                    full.classList.toggle('show');
                });

                searchResults.appendChild(card);
            });
        });

        // Navigation
        postsBtn.addEventListener('click', () => {
            postsBtn.classList.add('active');
            scoreBtn.classList.remove('active');
            profileBtn.classList.remove('active');
            searchBtn.classList.remove('active');
            introSection.classList.add('show');
            profileSection.classList.remove('show');
            scoreSection.classList.remove('show');
            searchSection.classList.remove('show');
            postsSection.style.display = 'block';
        });

        scoreBtn.addEventListener('click', () => {
            scoreBtn.classList.add('active');
            postsBtn.classList.remove('active');
            profileBtn.classList.remove('active');
            searchBtn.classList.remove('active');
            introSection.classList.remove('show');
            scoreSection.classList.add('show');
            profileSection.classList.remove('show');
            searchSection.classList.remove('show');
            postsSection.style.display = 'none';
        });

        profileBtn.addEventListener('click', () => {
            profileBtn.classList.add('active');
            postsBtn.classList.remove('active');
            scoreBtn.classList.remove('active');
            searchBtn.classList.remove('active');
            introSection.classList.remove('show');
            profileSection.classList.add('show');
            scoreSection.classList.remove('show');
            searchSection.classList.remove('show');
            postsSection.style.display = 'none';
        });

        searchBtn.addEventListener('click', () => {
            searchBtn.classList.add('active');
            postsBtn.classList.remove('active');
            scoreBtn.classList.remove('active');
            profileBtn.classList.remove('active');
            introSection.classList.remove('show');
            searchSection.classList.add('show');
            profileSection.classList.remove('show');
            scoreSection.classList.remove('show');
            postsSection.style.display = 'none';
            searchInput.value = '';
            searchResults.innerHTML = '<div class="no-results">Enter a keyword to search your posts.</div>';
        });

        // Profile Expand/Collapse
        profileHeader.addEventListener('click', () => {
            profileEdit.classList.toggle('show');
        });

        // Emoji selection
        emojiBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                emojiBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedEmoji = btn.textContent.trim();
                selectedMood = btn.dataset.mood;
                checkSubmit();
            });
        });

        // Tag selection
        tagBtns.forEach(tag => {
            tag.addEventListener('click', () => {
                tag.classList.toggle('selected');
                const tagText = tag.dataset.tag;
                if (tag.classList.contains('selected')) {
                    selectedTags.push(tagText);
                } else {
                    selectedTags = selectedTags.filter(t => t !== tagText);
                }
                checkSubmit();
            });
        });

        // Rich text toolbar
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const cmd = btn.dataset.cmd;
                document.execCommand(cmd, false, null);
                btn.classList.toggle('active', document.queryCommandState(cmd));
            });
        });

        // Journal input
        journal.addEventListener('input', () => {
            checkSubmit();
        });

        // Check if submit should be enabled
        function checkSubmit() {
            const text = journal.innerText.trim();
            submitBtn.disabled = !(selectedMood && text.length > 0);
        }

        // Submit
        submitBtn.addEventListener('click', async () => {
            const text = journal.innerHTML.trim();
            const plainText = journal.innerText.trim();

            if (!selectedMood || plainText.length === 0) return;

            thinking.style.display = 'block';
            aiResponse.style.display = 'none';
            submitBtn.disabled = true;

            let aiText = "I hear you. Try taking 3 slow breaths. You're not alone.";

            try {
                const response = await fetch('https://router.huggingface.co/hf-inference/models/mistralai/Mistral-7B-Instruct-v0.1', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer hf_YOU_NEED_TO_ADD_YOUR_OWN_KEY',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        inputs: `You are a kind, empathetic friend. Respond in 2-3 short lines:\n1. Acknowledge the feeling\n2. One tiny kind action\n3. A hopeful note\nUser feels: ${selectedMood}. They wrote: "${plainText.substring(0, 500)}"`,
                        parameters: { max_new_tokens: 100, temperature: 0.7 }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    aiText = data[0]?.generated_text?.split('User feels:')[1] || aiText;
                    aiText = aiText.trim().split('\n').slice(0, 3).join('<br>');
                }
            } catch (e) {
                console.log("API failed, using fallback");
            }

            thinking.style.display = 'none';
            aiResponse.innerHTML = aiText;
            aiResponse.style.display = 'block';

            // Save entry
            const entry = {
                emoji: selectedEmoji,
                mood: selectedMood,
                tags: [...selectedTags],
                text: text,
                aiResponse: aiText,
                timestamp: new Date().toISOString()
            };

            const entries = JSON.parse(localStorage.getItem('copedocEntries') || '[]');
            entries.unshift(entry);
            localStorage.setItem('copedocEntries', JSON.stringify(entries));

            // Update points and streak
            const pointsData = JSON.parse(localStorage.getItem('copedocPointsData') || '{}');
            pointsData.points = (pointsData.points || 0) + Math.max(10, Math.floor(plainText.length / 10));
            const today = new Date().toISOString().split('T')[0];
            const lastEntryDate = entries[1]?.timestamp?.split('T')[0] || '';
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];

            if (lastEntryDate === yesterdayStr || !lastEntryDate) {
                pointsData.streak = (pointsData.streak || 0) + 1;
            } else if (lastEntryDate !== today) {
                pointsData.streak = 1;
            }
            pointsData.points += 50; // Daily bonus
            if (!pointsData.badges) pointsData.badges = [];
            if (!pointsData.badges.includes('daily')) {
                pointsData.badges.push('daily');
            }
            localStorage.setItem('copedocPointsData', JSON.stringify(pointsData));
            updatePointsDisplay();

            loadHistory();
            resetForm();
            history.style.display = 'block';
        });

        function resetForm() {
            emojiBtns.forEach(b => b.classList.remove('selected'));
            tagBtns.forEach(t => t.classList.remove('selected'));
            journal.innerHTML = '';
            selectedMood = null;
            selectedEmoji = null;
            selectedTags = [];
            checkSubmit();
        }

        function loadHistory() {
            const entries = JSON.parse(localStorage.getItem('copedocEntries') || '[]');
            entriesContainer.innerHTML = '';

            entries.forEach((entry, index) => {
                const card = document.createElement('div');
                card.className = 'entry-card';
                card.innerHTML = `
                    <div class="entry-header">
                        <span class="entry-emoji">${entry.emoji}</span>
                        <span class="entry-mood">${entry.mood}</span>
                    </div>
                    <div class="entry-preview">${entry.text.replace(/<[^>]*>/g, '').substring(0, 60)}...</div>
                    <div class="entry-tags">
                        ${entry.tags.map(tag => `<span class="entry-tag">${tag}</span>`).join('')}
                    </div>
                    <div class="entry-time">${new Date(entry.timestamp).toLocaleString()}</div>
                    <div class="entry-full">
                        <div class="entry-text">${entry.text}</div>
                        <div class="ai-full">${entry.aiResponse}</div>
                    </div>
                `;

                card.addEventListener('click', () => {
                    const full = card.querySelector('.entry-full');
                    full.classList.toggle('show');
                });

                entriesContainer.appendChild(card);
            });
        }

        // Initialize
        window.addEventListener('load', () => {
            loadProfile();
            loadPoints();
            const entries = JSON.parse(localStorage.getItem('copedocEntries') || '[]');
            if (entries.length > 0) {
                loadHistory();
                history.style.display = 'block';
            }
        });
    </script>
</body>
</html>

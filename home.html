<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWL</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        :root {
            --Dark: #181A1C;
            --Green: #1a5c38;
            --Gold: #ffd800;
        }

        body {
            background-color: var(--Dark);
            color: #ffffff;
        }

        header {
            background-color: var(--Green);
            color: #ffffff;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header h1 {
            font-family: 'Audiowide', sans-serif;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1rem;
        }

        #search {
            width: 100%;
            max-width: 600px;
            padding: 0.5rem;
            margin: 1rem auto;
            font-size: 1rem;
            border: 1px solid var(--Dark);
            border-radius: 4px;
            display: block;
            background-color: #ffffff;
            color: var(--Dark);
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tab-button {
            padding: 0.5rem 1rem;
            background-color: var(--Green);
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-family: 'Audiowide', sans-serif;
            text-transform: uppercase;
            transition: background-color 0.3s;
        }

        .tab-button:hover {
            background-color: var(--Dark);
        }

        .tab-button.active {
            background-color: var(--Dark);
            border-radius: 4px 4px 0 0;
        }

        .tab-button.match-highlight {
            background-color: var(--Gold);
            color: var(--Dark);
        }

        main {
            width: 100%;
            padding: 1rem;
        }

        .list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
            width: 100%;
        }

        .item {
            display: flex;
            flex-direction: column;
        }

        .item-button {
            padding: 0.5rem;
            background-color: var(--Green);
            color: #ffffff;
            border: none;
            text-align: center;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .item-button:hover {
            background-color: var(--Green);
        }

        .content {
            display: none;
            padding: 1rem;
            background-color: var(--Dark);
            border: 3px solid var(--Green);
            border-radius: 0 0 4px 4px;
            width: 100%;
            grid-column: 1 / -1;
            color: #ffffff;
        }

        .about-section {
            margin-top: 1rem;
            text-align: left;
            padding: 1rem;
            background-color: #333;
            border-radius: 4px;
            color: #ffffff;
        }

        .about-section h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .about-section p {
            font-size: 1rem;
            line-height: 1.5;
        }

        .scripture-section {
            margin-bottom: 1rem;
        }

        .scripture-section ul {
            list-style-type: disc;
            margin-left: 1.5rem;
        }

        .scripture-section em {
            font-style: italic;
        }

        .description-section {
            margin-top: 1rem;
        }

        .highlight {
            background-color: #ffd800;
            font-weight: bold;
            color: var(--Dark);
        }

        @media (max-width: 768px) {
            .list {
                grid-template-columns: repeat(2, 1fr);
            }

            .tab-button {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .list {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .item-button {
                font-size: 0.9rem;
            }

            main {
                padding: 0.5rem;
            }

            .tab-button {
                font-size: 0.8rem;
                padding: 0.3rem 0.6rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>JWL</h1>
        <p>Walk Wise</p>
        <input type="text" id="search" placeholder="Search items..." onkeyup="searchItems()">
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('launch')">LAUNCH</button>
            <button class="tab-button" onclick="showTab('topics')">TOPICS</button>
            <button class="tab-button" onclick="showTab('people')">PEOPLE</button>
        </div>
    </header>
    <main>
        <div class="list" id="launch" style="display: grid;"></div>
        <div class="list" id="topics" style="display: none;"></div>
        <div class="list" id="people" style="display: none;"></div>
    </main>
    <script src="launch.js"></script>
    <script src="topics.js"></script>
    <script src="people.js"></script>
    <script>
        // Sort items alphabetically by title
        const sortedLaunch = launchItems.slice().sort((a, b) => a.T.localeCompare(b.T));
        const sortedTopics = items.slice().sort((a, b) => a.T.localeCompare(b.T));
        const sortedPeople = people.slice().sort((a, b) => a.T.localeCompare(b.T));

        // Define categories
        const categories = {
            'launch': sortedLaunch,
            'topics': sortedTopics,
            'people': sortedPeople
        };

        // Function to reset the view for categories (Launch, Topics, People)
        function resetView() {
            console.log('Resetting view');
            const searchResults = document.getElementById('search-results');
            if (searchResults) searchResults.remove();
            const searchTerm = document.getElementById('search').value.toLowerCase();
            Object.keys(categories).forEach(category => {
                const itemList = document.getElementById(category);
                itemList.innerHTML = ''; // Clear existing items
                categories[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    const itemButton = document.createElement('button');
                    itemButton.className = 'item-button';
                    itemButton.innerHTML = searchTerm ? 
                        item.T.replace(new RegExp(`(${searchTerm})`, 'gi'), '<span class="highlight">$1</span>') : 
                        item.T;
                    const content = document.createElement('div');
                    content.className = 'content';
                    const scriptures = searchTerm ? 
                        item.S.map(scripture => scripture.replace(new RegExp(`(${searchTerm})`, 'gi'), '<span class="highlight">$1</span>')) : 
                        item.S;
                    const description = searchTerm ? 
                        item.D.replace(new RegExp(`(${searchTerm})`, 'gi'), '<span class="highlight">$1</span>') : 
                        item.D;
                    content.innerHTML = `
                        <div class="scripture-section"><ul>${scriptures.map(s => `<li>${s}</li>`).join('')}</ul></div>
                        <div class="description-section">${description}</div>
                    `;
                    if (category === 'launch') {
                        content.innerHTML += `
                            <div class="about-section">
                                <h3>About JWL</h3>
                                <p>The purpose of JWL (Walk Wise) is to restore the original pure worship Jehovah approves. We aim to provide resources, scriptures, and insights that guide you in aligning with Jehovahâ€™s standards and principles for true worship.</p>
                            </div>
                        `;
                    }
                    content.style.display = 'none';
                    itemDiv.appendChild(itemButton);
                    itemList.appendChild(itemDiv);
                    itemList.appendChild(content);
                    itemButton.addEventListener('click', () => {
                        console.log(`Clicked ${item.T}, isOpen: ${content.style.display === 'block'}`);
                        const isOpen = content.style.display === 'block';
                        document.querySelectorAll('.content').forEach(c => {
                            c.style.display = 'none';
                        });
                        if (!isOpen) {
                            content.style.display = 'block';
                        }
                    });
                });
            });
            showTab('launch');
        }

        // Tab switching functionality
        function showTab(category) {
            console.log(`Switching to tab: ${category}`);
            document.querySelectorAll('.content').forEach(c => {
                c.style.display = 'none';
            });
            const searchResults = document.getElementById('search-results');
            if (searchResults) searchResults.remove();
            document.querySelectorAll('.list').forEach(section => section.style.display = 'none');
            document.getElementById(category).style.display = 'grid';
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'match-highlight'));
            document.querySelector(`[onclick="showTab('${category}')"]`).classList.add('active');

            // Highlight matching tabs based on search term
            const searchTerm = document.getElementById('search').value.toLowerCase();
            if (searchTerm) {
                const categoriesWithMatches = new Set();
                Object.keys(categories).forEach(cat => {
                    const items = categories[cat];
                    items.forEach(item => {
                        const titleMatch = item.T.toLowerCase().includes(searchTerm);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        const contentMatch = scripturesText.includes(searchTerm) || descriptionText.includes(searchTerm);
                        if (titleMatch || contentMatch) {
                            categoriesWithMatches.add(cat);
                        }
                    });
                });
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('match-highlight'));
                categoriesWithMatches.forEach(cat => {
                    const tabButton = document.querySelector(`[onclick="showTab('${cat}')"]`);
                    if (tabButton) tabButton.classList.add('match-highlight');
                });
            }
        }

        // Search functionality
        let debounceTimeout;
        function searchItems() {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => {
                const input = document.getElementById('search').value.toLowerCase();
                console.log(`Searching for: ${input}`);
                if (!input) {
                    resetView();
                    return;
                }

                const allList = document.createElement('div');
                allList.className = 'list';
                allList.id = 'search-results';
                const main = document.querySelector('main');
                const existingResults = document.getElementById('search-results');
                if (existingResults) existingResults.remove();
                main.appendChild(allList);

                const categoriesWithMatches = new Set();
                const matchingItems = [];
                Object.keys(categories).forEach(category => {
                    const items = categories[category];
                    items.forEach(item => {
                        const titleMatch = item.T.toLowerCase().includes(input);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        const contentMatch = scripturesText.includes(input) || descriptionText.includes(input);

                        if (titleMatch || contentMatch) {
                            categoriesWithMatches.add(category);
                            matchingItems.push({ item, category });
                        }
                    });
                    const itemList = document.getElementById(category);
                    itemList.querySelectorAll('.item').forEach(itemDiv => {
                        const itemTitle = itemDiv.querySelector('.item-button').textContent;
                        const item = categories[category].find(i => i.T === itemTitle);
                        const titleMatch = item.T.toLowerCase().includes(input);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        itemDiv.style.display = (titleMatch || scripturesText.includes(input) || descriptionText.includes(input)) ? '' : 'none';
                    });
                });

                // Sort matching items: exact matches first, then extended matches
                matchingItems.sort((a, b) => {
                    const aText = `${a.item.T} ${a.item.S.join(' ')} ${a.item.D}`.toLowerCase();
                    const bText = `${b.item.T} ${b.item.S.join(' ')} ${b.item.D}`.toLowerCase();
                    const aIsExact = aText === input || a.item.T.toLowerCase() === input || a.item.S.some(s => s.toLowerCase() === input) || a.item.D.toLowerCase() === input;
                    const bIsExact = bText === input || b.item.T.toLowerCase() === input || b.item.S.some(s => s.toLowerCase() === input) || b.item.D.toLowerCase() === input;
                    if (aIsExact && !bIsExact) return -1; // a is exact, b is not
                    if (!aIsExact && bIsExact) return 1;  // b is exact, a is not
                    return a.item.T.localeCompare(b.item.T); // Both are same type, sort alphabetically
                });

                matchingItems.forEach(({ item, category }) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    const itemButton = document.createElement('button');
                    itemButton.className = 'item-button';
                    itemButton.innerHTML = item.T.replace(new RegExp(`(${input})`, 'gi'), '<span class="highlight">$1</span>');
                    const content = document.createElement('div');
                    content.className = 'content';
                    const highlightedScriptures = item.S.map(scripture =>
                        scripture.replace(new RegExp(`(${input})`, 'gi'), '<span class="highlight">$1</span>')
                    );
                    const highlightedDescription = item.D.replace(new RegExp(`(${input})`, 'gi'), '<span class="highlight">$1</span>');
                    content.innerHTML = `
                        <div class="scripture-section"><ul>${highlightedScriptures.map(s => `<li>${s}</li>`).join('')}</ul></div>
                        <div class="description-section">${highlightedDescription}</div>
                    `;
                    if (category === 'launch') {
                        content.innerHTML += `
                            <div class="about-section">
                                <h3>About JWL</h3>
                                <p>The purpose of JWL (Walk Wise) is to restore the original pure worship Jehovah approves. We aim to provide resources, scriptures, and insights that guide you in aligning with Jehovahâ€™s standards and principles for true worship.</p>
                            </div>
                        `;
                    }
                    content.style.display = 'block';
                    itemDiv.appendChild(itemButton);
                    allList.appendChild(itemDiv);
                    allList.appendChild(content);
                    itemButton.addEventListener('click', () => {
                        console.log(`Clicked ${item.T}, isOpen: ${content.style.display === 'block'}`);
                        const isOpen = content.style.display === 'block';
                        document.querySelectorAll('.content').forEach(c => {
                            c.style.display = 'none';
                        });
                        if (!isOpen) {
                            content.style.display = 'block';
                        }
                    });
                });

                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('match-highlight'));
                categoriesWithMatches.forEach(category => {
                    const tabButton = document.querySelector(`[onclick="showTab('${category}')"]`);
                    if (tabButton) tabButton.classList.add('match-highlight');
                });

                document.querySelectorAll('.list').forEach(section => section.style.display = 'none');
                allList.style.display = 'grid';
                const firstVisibleItem = allList.querySelector('.item');
                if (firstVisibleItem) firstVisibleItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
                else resetView();
            }, 300);
        }

        // Reset display when search is cleared
        document.getElementById('search').addEventListener('input', () => {
            const input = document.getElementById('search').value;
            console.log(`Search input changed: ${input}`);
            if (!input) {
                const searchResults = document.getElementById('search-results');
                if (searchResults) searchResults.remove();
                resetView();
            } else {
                searchItems();
            }
        });

        // Populate categories on load
        resetView();
    </script>
</body>
</html>

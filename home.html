<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWL</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="hamburger" onclick="toggleMenu('left-menu')">☰</div>
        <div class="header-content">
            <h1 onclick="goToHome()">JWL</h1>
        </div>
        <div class="hamburger" onclick="toggleMenu('right-menu')">☰</div>
        <div id="left-menu" class="hamburger-menu" style="left: 1rem; top: 1rem;">
            <a href="game.html">GAME</a>
            <a href="news.html">NEWS</a>
        </div>
        <div id="right-menu" class="hamburger-menu" style="right: 1rem; top: 1rem;">
            <a href="drone.html">DRONE</a>
            <a href="note.html">NOTE</a>
        </div>
    </header>
    <section class="main-content">
        <div class="about-section">
            <h3 onclick="toggleAbout()">About</h3>
            <div id="about-content" class="about-content">
                The purpose of Just Wise Love is to restore pure worship to its original form that Jehovah approves. We aim to provide resources, scriptures, and insights that guide you in aligning with Jehovah’s standards and principles for true worship.
            </div>
        </div>
        <div class="search-section">
            <h3 onclick="toggleSearch()">Search</h3>
            <div id="search-content" class="search-content">
                <input type="text" id="search" placeholder="-Search For Bible Truth-" onkeyup="searchItems()">
            </div>
        </div>
        <div class="tabs">
            <button class="tab-button" onclick="showTab('launch')">LAUNCH</button>
            <button class="tab-button" onclick="showTab('topics')">TOPICS</button>
            <button class="tab-button" onclick="showTab('people')">PEOPLE</button>
        </div>
        <div class="list" id="launch" style="display: none;"></div>
        <div class="list" id="topics" style="display: none;"></div>
        <div class="list" id="people" style="display: none;"></div>
    </section>
    <footer>
        <p>© Just Wise Love</p>
    </footer>
    <script src="launch.js"></script>
    <script src="topics.js"></script>
    <script src="people.js"></script>
    <script>
        // Toggle hamburger menu visibility
        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menus = document.querySelectorAll('.hamburger-menu');
            const hamburgers = document.querySelectorAll('.hamburger');
            let clickInside = false;
            hamburgers.forEach(hamburger => {
                if (hamburger.contains(event.target)) clickInside = true;
            });
            if (!clickInside) {
                menus.forEach(menu => menu.style.display = 'none');
            }
        });

        // Toggle About section
        function toggleAbout() {
            const content = document.getElementById('about-content');
            content.classList.toggle('expanded');
        }

        // Toggle Search section
        function toggleSearch() {
            const content = document.getElementById('search-content');
            content.classList.toggle('expanded');
        }

        // Redirect to home.html
        function goToHome() {
            window.location.href = 'home.html';
        }

        // Sort items alphabetically by title
        const sortedLaunch = launch.slice().sort((a, b) => a.T.localeCompare(b.T));
        const sortedTopics = topics.slice().sort((a, b) => a.T.localeCompare(b.T));
        const sortedPeople = people.slice().sort((a, b) => a.T.localeCompare(b.T));

        // Define categories
        const categories = {
            'launch': sortedLaunch,
            'topics': sortedTopics,
            'people': sortedPeople
        };

        // Function to reset the view for categories (Launch, Topics, People)
        function resetView() {
            console.log('Resetting view');
            const searchResults = document.getElementById('search-results');
            if (searchResults) searchResults.remove();
            const searchTerm = document.getElementById('search').value.toLowerCase();
            Object.keys(categories).forEach(category => {
                const itemList = document.getElementById(category);
                itemList.innerHTML = ''; // Clear existing items
                categories[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    const itemButton = document.createElement('button');
                    itemButton.className = 'item-button';
                    itemButton.innerHTML = searchTerm ? 
                        item.T.replace(new RegExp(`(${searchTerm})`, 'gi'), '<span class="highlight">$1</span>') : 
                        item.T;
                    const content = document.createElement('div');
                    content.className = 'content';
                    const scriptures = searchTerm ? 
                        item.S.map(scripture => scripture.replace(new RegExp(`(${searchTerm})`, 'gi'), '<span class="highlight">$1</span>')) : 
                        item.S;
                    const description = searchTerm ? 
                        item.D.replace(new RegExp(`(${searchTerm})`, 'gi'), '<span class="highlight">$1</span>') : 
                        item.D;
                    content.innerHTML = `
                        <div class="scripture-section"><ul>${scriptures.map(s => `<li>${s}</li>`).join('')}</ul></div>
                        <div class="description-section">${description}</div>
                    `;
                    content.style.display = 'none';
                    itemDiv.appendChild(itemButton);
                    itemList.appendChild(itemDiv);
                    itemList.appendChild(content);
                    itemButton.addEventListener('click', () => {
                        console.log(`Clicked ${item.T}, isOpen: ${content.style.display === 'block'}`);
                        const isOpen = content.style.display === 'block';
                        document.querySelectorAll('.content').forEach(c => {
                            c.style.display = 'none';
                        });
                        if (!isOpen) {
                            content.style.display = 'block';
                        }
                    });
                });
            });
            // Do not show any tab by default
            document.querySelectorAll('.list').forEach(section => section.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'match-highlight'));
        }

        // Tab switching functionality
        function showTab(category) {
            console.log(`Switching to tab: ${category}`);
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const searchResults = document.getElementById('search-results');

            // If there's a search term, don't modify the search results
            if (searchTerm && searchResults) {
                // Only update the active tab button
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'match-highlight'));
                document.querySelector(`[onclick="showTab('${category}')"]`).classList.add('active');

                // Highlight matching tabs based on search term
                const categoriesWithMatches = new Set();
                Object.keys(categories).forEach(cat => {
                    const items = categories[cat];
                    items.forEach(item => {
                        const titleMatch = item.T.toLowerCase().includes(searchTerm);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        const contentMatch = scripturesText.includes(searchTerm) || descriptionText.includes(searchTerm);
                        if (titleMatch || contentMatch) {
                            categoriesWithMatches.add(cat);
                        }
                    });
                });
                categoriesWithMatches.forEach(cat => {
                    const tabButton = document.querySelector(`[onclick="showTab('${cat}')"]`);
                    if (tabButton) tabButton.classList.add('match-highlight');
                });
                return; // Exit to keep search results visible
            }

            // If no search term, proceed with normal tab switching
            document.querySelectorAll('.content').forEach(c => {
                c.style.display = 'none';
            });
            if (searchResults) searchResults.remove();
            document.querySelectorAll('.list').forEach(section => section.style.display = 'none');
            document.getElementById(category).style.display = 'grid';
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'match-highlight'));
            document.querySelector(`[onclick="showTab('${category}')"]`).classList.add('active');

            // Highlight matching tabs based on search term (if any)
            if (searchTerm) {
                const categoriesWithMatches = new Set();
                Object.keys(categories).forEach(cat => {
                    const items = categories[cat];
                    items.forEach(item => {
                        const titleMatch = item.T.toLowerCase().includes(searchTerm);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        const contentMatch = scripturesText.includes(searchTerm) || descriptionText.includes(searchTerm);
                        if (titleMatch || contentMatch) {
                            categoriesWithMatches.add(cat);
                        }
                    });
                });
                categoriesWithMatches.forEach(cat => {
                    const tabButton = document.querySelector(`[onclick="showTab('${cat}')"]`);
                    if (tabButton) tabButton.classList.add('match-highlight');
                });
            }
        }

        // Search functionality
        let debounceTimeout;
        function searchItems() {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => {
                const input = document.getElementById('search').value.toLowerCase();
                console.log(`Searching for: ${input}`);
                if (!input) {
                    resetView();
                    return;
                }

                const allList = document.createElement('div');
                allList.className = 'list';
                allList.id = 'search-results';
                const main = document.querySelector('.main-content');
                const existingResults = document.getElementById('search-results');
                if (existingResults) existingResults.remove();
                main.appendChild(allList);

                const categoriesWithMatches = new Set();
                const matchingItems = [];
                Object.keys(categories).forEach(category => {
                    const items = categories[category];
                    items.forEach(item => {
                        const titleMatch = item.T.toLowerCase().includes(input);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        const contentMatch = scripturesText.includes(input) || descriptionText.includes(input);

                        if (titleMatch || contentMatch) {
                            categoriesWithMatches.add(category);
                            matchingItems.push({ item, category });
                        }
                    });
                    const itemList = document.getElementById(category);
                    itemList.querySelectorAll('.item').forEach(itemDiv => {
                        const itemTitle = itemDiv.querySelector('.item-button').textContent;
                        const item = categories[category].find(i => i.T === itemTitle);
                        const titleMatch = item.T.toLowerCase().includes(input);
                        const scripturesText = item.S.join(' ').toLowerCase();
                        const descriptionText = item.D.toLowerCase();
                        itemDiv.style.display = (titleMatch || scripturesText.includes(input) || descriptionText.includes(input)) ? '' : 'none';
                    });
                });

                // Sort matching items: exact matches first, then extended matches
                matchingItems.sort((a, b) => {
                    const aText = `${a.item.T} ${a.item.S.join(' ')} ${a.item.D}`.toLowerCase();
                    const bText = `${b.item.T} ${b.item.S.join(' ')} ${b.item.D}`.toLowerCase();
                    const aIsExact = aText === input || a.item.T.toLowerCase() === input || a.item.S.some(s => s.toLowerCase() === input) || a.item.D.toLowerCase() === input;
                    const bIsExact = bText === input || b.item.T.toLowerCase() === input || b.item.S.some(s => s.toLowerCase() === input) || b.item.D.toLowerCase() === input;
                    if (aIsExact && !bIsExact) return -1; // a is exact, b is not
                    if (!aIsExact && bIsExact) return 1;  // b is exact, a is not
                    return a.item.T.localeCompare(b.item.T); // Both are same type, sort alphabetically
                });

                matchingItems.forEach(({ item, category }) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    const itemButton = document.createElement('button');
                    itemButton.className = 'item-button';
                    itemButton.innerHTML = item.T.replace(new RegExp(`(${input})`, 'gi'), '<span class="highlight">$1</span>');
                    const content = document.createElement('div');
                    content.className = 'content';
                    const highlightedScriptures = item.S.map(scripture =>
                        scripture.replace(new RegExp(`(${input})`, 'gi'), '<span class="highlight">$1</span>')
                    );
                    const highlightedDescription = item.D.replace(new RegExp(`(${input})`, 'gi'), '<span class="highlight">$1</span>');
                    content.innerHTML = `
                        <div class="scripture-section"><ul>${highlightedScriptures.map(s => `<li>${s}</li>`).join('')}</ul></div>
                        <div class="description-section">${highlightedDescription}</div>
                    `;
                    content.style.display = 'block'; // Keep content open by default for search results
                    itemDiv.appendChild(itemButton);
                    allList.appendChild(itemDiv);
                    allList.appendChild(content);
                    itemButton.addEventListener('click', () => {
                        console.log(`Clicked ${item.T}, isOpen: ${content.style.display === 'block'}`);
                        const isOpen = content.style.display === 'block';
                        document.querySelectorAll('.content').forEach(c => {
                            c.style.display = 'none';
                        });
                        if (!isOpen) {
                            content.style.display = 'block';
                        }
                    });
                });

                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('match-highlight'));
                categoriesWithMatches.forEach(category => {
                    const tabButton = document.querySelector(`[onclick="showTab('${category}')"]`);
                    if (tabButton) tabButton.classList.add('match-highlight');
                });

                document.querySelectorAll('.list').forEach(section => section.style.display = 'none');
                allList.style.display = 'grid';
                const firstVisibleItem = allList.querySelector('.item');
                if (firstVisibleItem) firstVisibleItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
                else resetView();
            }, 300);
        }

        // Reset display when search is cleared
        document.getElementById('search').addEventListener('input', () => {
            const input = document.getElementById('search').value;
            console.log(`Search input changed: ${input}`);
            if (!input) {
                const searchResults = document.getElementById('search-results');
                if (searchResults) searchResults.remove();
                resetView();
            } else {
                searchItems();
            }
        });

        // Populate categories on load
        resetView();
    </script>
</body>
</html>
